--- iris_osm.xml	2011-05-23 10:18:54.000000000 -0500
+++ iris_osm.xml	2011-05-23 10:19:12.000000000 -0500
@@ -5348,52 +5348,22 @@
       <ShieldSymbolizer name="tref" fontset_name="bold-fonts" size="10" fill="#fff" placement="line" file="&symbols;/trunk_highway3.png" min_distance="30" spacing="750"/>
     </Rule>
     <Rule>
-      <Filter>[highway] = 'primary' and [length] = 1</Filter>
+      <Filter>([highway] = 'primary' or [highway] = 'secondary' or [highway] = 'tertiary') and [tlength] = 1</Filter>
       &maxscale_zoom11;
       &minscale_zoom12;
-      <ShieldSymbolizer name="ref" fontset_name="bold-fonts" size="10" fill="#fff" placement="line" file="&symbols;/pri_shield1.png" min_distance="30" spacing="750"/>
+      <ShieldSymbolizer name="tref" fontset_name="bold-fonts" size="10" fill="#000" placement="line" file="&symbols;/primary1.png" min_distance="30" spacing="750"/>
     </Rule>
     <Rule>
-      <Filter>[highway] = 'primary' and [length] = 2</Filter>
+      <Filter>([highway] = 'primary' or [highway] = 'secondary' or [highway] = 'tertiary') and [tlength] = 2</Filter>
       &maxscale_zoom11;
       &minscale_zoom12;
-      <ShieldSymbolizer name="ref" fontset_name="bold-fonts" size="10" fill="#fff" placement="line" file="&symbols;/pri_shield2.png" min_distance="30" spacing="750"/>
+      <ShieldSymbolizer name="tref" fontset_name="bold-fonts" size="10" fill="#000" placement="line" file="&symbols;/primary2.png" min_distance="30" spacing="750"/>
     </Rule>
     <Rule>
-      <Filter>[highway] = 'primary' and [length] = 3</Filter>
+      <Filter>([highway] = 'primary' or [highway] = 'secondary' or [highway] = 'tertiary') and [tlength] >= 3</Filter>
       &maxscale_zoom11;
       &minscale_zoom12;
-      <ShieldSymbolizer name="ref" fontset_name="bold-fonts" size="10" fill="#fff" placement="line" file="&symbols;/pri_shield3.png" min_distance="30" spacing="750"/>
-    </Rule>
-    <Rule>
-      <Filter>[highway] = 'primary' and [length] = 4</Filter>
-      &maxscale_zoom11;
-      &minscale_zoom12;
-      <ShieldSymbolizer name="ref" fontset_name="bold-fonts" size="10" fill="#fff" placement="line" file="&symbols;/pri_shield4.png" min_distance="30" spacing="750"/>
-    </Rule>
-    <Rule>
-      <Filter>[highway] = 'primary' and [length] = 5</Filter>
-      &maxscale_zoom11;
-      &minscale_zoom12;
-      <ShieldSymbolizer name="ref" fontset_name="bold-fonts" size="10" fill="#fff" placement="line" file="&symbols;/pri_shield5.png" min_distance="30" spacing="750"/>
-    </Rule>
-    <Rule>
-      <Filter>[highway] = 'primary' and [length] = 6</Filter>
-      &maxscale_zoom11;
-      &minscale_zoom12;
-      <ShieldSymbolizer name="ref" fontset_name="bold-fonts" size="10" fill="#fff" placement="line" file="&symbols;/pri_shield6.png" min_distance="30" spacing="750"/>
-    </Rule>
-    <Rule>
-      <Filter>[highway] = 'primary' and [length] = 7</Filter>
-      &maxscale_zoom11;
-      &minscale_zoom12;
-      <ShieldSymbolizer name="ref" fontset_name="bold-fonts" size="10" fill="#fff" placement="line" file="&symbols;/pri_shield7.png" min_distance="30" spacing="750"/>
-    </Rule>
-    <Rule>
-      <Filter>[highway] = 'primary' and [length] = 8</Filter>
-      &maxscale_zoom11;
-      &minscale_zoom12;
-      <ShieldSymbolizer name="ref" fontset_name="bold-fonts" size="10" fill="#fff" placement="line" file="&symbols;/pri_shield8.png" min_distance="30" spacing="750"/>
+      <ShieldSymbolizer name="tref" fontset_name="bold-fonts" size="10" fill="#000" placement="line" file="&symbols;/primary3.png" min_distance="30" spacing="750"/>
     </Rule>
 </Style>
 <Style name="roads-text">
@@ -5452,148 +5422,22 @@
       <ShieldSymbolizer name="tref" fontset_name="bold-fonts" size="10" fill="#fff" placement="line" file="&symbols;/trunk_highway3.png" min_distance="30" spacing="750"/>
     </Rule>
     <Rule>
-      <Filter>[highway] = 'primary' and [length] = 1</Filter>
-      &maxscale_zoom13;
-      &minscale_zoom18;
-      <ShieldSymbolizer name="ref" fontset_name="bold-fonts" size="10" fill="#fff" placement="line" file="&symbols;/pri_shield1.png" min_distance="30" spacing="750"/>
-    </Rule>
-    <Rule>
-      <Filter>[highway] = 'primary' and [length] = 2</Filter>
-      &maxscale_zoom13;
-      &minscale_zoom18;
-      <ShieldSymbolizer name="ref" fontset_name="bold-fonts" size="10" fill="#fff" placement="line" file="&symbols;/pri_shield2.png" min_distance="30" spacing="750"/>
-    </Rule>
-    <Rule>
-      <Filter>[highway] = 'primary' and [length] = 3</Filter>
-      &maxscale_zoom13;
-      &minscale_zoom18;
-      <ShieldSymbolizer name="ref" fontset_name="bold-fonts" size="10" fill="#fff" placement="line" file="&symbols;/pri_shield3.png" min_distance="30" spacing="750"/>
-    </Rule>
-    <Rule>
-      <Filter>[highway] = 'primary' and [length] = 4</Filter>
-      &maxscale_zoom13;
-      &minscale_zoom18;
-      <ShieldSymbolizer name="ref" fontset_name="bold-fonts" size="10" fill="#fff" placement="line" file="&symbols;/pri_shield4.png" min_distance="30" spacing="750"/>
-    </Rule>
-    <Rule>
-      <Filter>[highway] = 'primary' and [length] = 5</Filter>
-      &maxscale_zoom13;
-      &minscale_zoom18;
-      <ShieldSymbolizer name="ref" fontset_name="bold-fonts" size="10" fill="#fff" placement="line" file="&symbols;/pri_shield5.png" min_distance="30" spacing="750"/>
-    </Rule>
-    <Rule>
-      <Filter>[highway] = 'primary' and [length] = 6</Filter>
-      &maxscale_zoom13;
-      &minscale_zoom18;
-      <ShieldSymbolizer name="ref" fontset_name="bold-fonts" size="10" fill="#fff" placement="line" file="&symbols;/pri_shield6.png" min_distance="30" spacing="750"/>
-    </Rule>
-    <Rule>
-      <Filter>[highway] = 'primary' and [length] = 7</Filter>
-      &maxscale_zoom13;
-      &minscale_zoom18;
-      <ShieldSymbolizer name="ref" fontset_name="bold-fonts" size="10" fill="#fff" placement="line" file="&symbols;/pri_shield7.png" min_distance="30" spacing="750"/>
-    </Rule>
-    <Rule>
-      <Filter>[highway] = 'primary' and [length] = 8</Filter>
-      &maxscale_zoom13;
-      &minscale_zoom18;
-      <ShieldSymbolizer name="ref" fontset_name="bold-fonts" size="10" fill="#fff" placement="line" file="&symbols;/pri_shield8.png" min_distance="30" spacing="750"/>
-    </Rule>
-    <Rule>
-      <Filter>([highway] = 'secondary' and [length] = 1) and not [bridge]='yes'</Filter>
-      &maxscale_zoom12;
-      &minscale_zoom18;
-      <ShieldSymbolizer name="ref" fontset_name="bold-fonts" size="10" fill="#fff" placement="line" file="&symbols;/sec_shield1.png" min_distance="40" spacing="750"/>
-    </Rule>
-    <Rule>
-      <Filter>([highway] = 'secondary' and [length] = 2) and not [bridge]='yes'</Filter>
-      &maxscale_zoom12;
-      &minscale_zoom18;
-      <ShieldSymbolizer name="ref" fontset_name="bold-fonts" size="10" fill="#fff" placement="line" file="&symbols;/sec_shield2.png" min_distance="40" spacing="750"/>
-    </Rule>
-    <Rule>
-      <Filter>([highway] = 'secondary' and [length] = 3) and not [bridge]='yes'</Filter>
-      &maxscale_zoom12;
-      &minscale_zoom18;
-      <ShieldSymbolizer name="ref" fontset_name="bold-fonts" size="10" fill="#fff" placement="line" file="&symbols;/sec_shield3.png" min_distance="40" spacing="750"/>
-    </Rule>
-    <Rule>
-      <Filter>([highway] = 'secondary' and [length] = 4) and not [bridge]='yes'</Filter>
-      &maxscale_zoom12;
-      &minscale_zoom18;
-      <ShieldSymbolizer name="ref" fontset_name="bold-fonts" size="10" fill="#fff" placement="line" file="&symbols;/sec_shield4.png" min_distance="40" spacing="750"/>
-    </Rule>
-    <Rule>
-      <Filter>([highway] = 'secondary' and [length] = 5) and not [bridge]='yes'</Filter>
-      &maxscale_zoom12;
-      &minscale_zoom18;
-      <ShieldSymbolizer name="ref" fontset_name="bold-fonts" size="10" fill="#fff" placement="line" file="&symbols;/sec_shield5.png" min_distance="40" spacing="750"/>
-    </Rule>
-    <Rule>
-      <Filter>([highway] = 'secondary' and [length] = 6) and not [bridge]='yes'</Filter>
-      &maxscale_zoom12;
-      &minscale_zoom18;
-      <ShieldSymbolizer name="ref" fontset_name="bold-fonts" size="10" fill="#fff" placement="line" file="&symbols;/sec_shield6.png" min_distance="40" spacing="750"/>
-    </Rule>
-    <Rule>
-      <Filter>([highway] = 'secondary' and [length] = 7) and not [bridge]='yes'</Filter>
-      &maxscale_zoom12;
-      &minscale_zoom18;
-      <ShieldSymbolizer name="ref" fontset_name="bold-fonts" size="10" fill="#fff" placement="line" file="&symbols;/sec_shield7.png" min_distance="40" spacing="750"/>
-    </Rule>
-    <Rule>
-      <Filter>([highway] = 'secondary' and [length] = 8) and not [bridge]='yes'</Filter>
-      &maxscale_zoom12;
-      &minscale_zoom18;
-      <ShieldSymbolizer name="ref" fontset_name="bold-fonts" size="10" fill="#fff" placement="line" file="&symbols;/sec_shield8.png" min_distance="40" spacing="750"/>
-    </Rule>
-    <Rule>
-      <Filter>([highway] = 'tertiary' and [length] = 1) and not [bridge]='yes'</Filter>
-      &maxscale_zoom13;
-      &minscale_zoom18;
-      <ShieldSymbolizer name="ref" fontset_name="bold-fonts" size="10" fill="#fff" placement="line" file="&symbols;/ter_shield1.png" min_distance="40" spacing="750"/>
-    </Rule>
-    <Rule>
-      <Filter>([highway] = 'tertiary' and [length] = 2) and not [bridge]='yes'</Filter>
-      &maxscale_zoom13;
-      &minscale_zoom18;
-      <ShieldSymbolizer name="ref" fontset_name="bold-fonts" size="10" fill="#fff" placement="line" file="&symbols;/ter_shield2.png" min_distance="40" spacing="750"/>
-    </Rule>
-    <Rule>
-      <Filter>([highway] = 'tertiary' and [length] = 3) and not [bridge]='yes'</Filter>
-      &maxscale_zoom13;
-      &minscale_zoom18;
-      <ShieldSymbolizer name="ref" fontset_name="bold-fonts" size="10" fill="#fff" placement="line" file="&symbols;/ter_shield3.png" min_distance="40" spacing="750"/>
-    </Rule>
-    <Rule>
-      <Filter>([highway] = 'tertiary' and [length] = 4) and not [bridge]='yes'</Filter>
-      &maxscale_zoom13;
-      &minscale_zoom18;
-      <ShieldSymbolizer name="ref" fontset_name="bold-fonts" size="10" fill="#fff" placement="line" file="&symbols;/ter_shield4.png" min_distance="40" spacing="750"/>
-    </Rule>
-    <Rule>
-      <Filter>([highway] = 'tertiary' and [length] = 5) and not [bridge]='yes'</Filter>
-      &maxscale_zoom13;
-      &minscale_zoom18;
-      <ShieldSymbolizer name="ref" fontset_name="bold-fonts" size="10" fill="#fff" placement="line" file="&symbols;/ter_shield5.png" min_distance="40" spacing="750"/>
-    </Rule>
-    <Rule>
-      <Filter>([highway] = 'tertiary' and [length] = 6) and not [bridge]='yes'</Filter>
+      <Filter>([highway] = 'primary' or [highway] = 'secondary' or [highway] = 'tertiary') and [tlength] = 1</Filter>
       &maxscale_zoom13;
       &minscale_zoom18;
-      <ShieldSymbolizer name="ref" fontset_name="bold-fonts" size="10" fill="#fff" placement="line" file="&symbols;/ter_shield6.png" min_distance="40" spacing="750"/>
+      <ShieldSymbolizer name="tref" fontset_name="bold-fonts" size="10" fill="#000" placement="line" file="&symbols;/primary1.png" min_distance="30" spacing="750"/>
     </Rule>
     <Rule>
-      <Filter>([highway] = 'tertiary' and [length] = 7) and not [bridge]='yes'</Filter>
+      <Filter>([highway] = 'primary' or [highway] = 'secondary' or [highway] = 'tertiary') and [tlength] = 2</Filter>
       &maxscale_zoom13;
       &minscale_zoom18;
-      <ShieldSymbolizer name="ref" fontset_name="bold-fonts" size="10" fill="#fff" placement="line" file="&symbols;/ter_shield7.png" min_distance="40" spacing="750"/>
+      <ShieldSymbolizer name="tref" fontset_name="bold-fonts" size="10" fill="#000" placement="line" file="&symbols;/primary2.png" min_distance="30" spacing="750"/>
     </Rule>
     <Rule>
-      <Filter>([highway] = 'tertiary' and [length] = 8) and not [bridge]='yes'</Filter>
+      <Filter>([highway] = 'primary' or [highway] = 'secondary' or [highway] = 'tertiary') and [tlength] >= 3</Filter>
       &maxscale_zoom13;
       &minscale_zoom18;
-      <ShieldSymbolizer name="ref" fontset_name="bold-fonts" size="10" fill="#fff" placement="line" file="&symbols;/ter_shield8.png" min_distance="40" spacing="750"/>
+      <ShieldSymbolizer name="tref" fontset_name="bold-fonts" size="10" fill="#000" placement="line" file="&symbols;/primary3.png" min_distance="30" spacing="750"/>
     </Rule>
     <Rule>
       <Filter>([highway] = 'unclassified' or [highway]='residential') and not [bridge]='yes'</Filter>
@@ -6474,8 +6318,8 @@
       <Parameter name="table">
       (select way,highway,ref,char_length(ref) as length,
        replace(substring(ref for 2), ' ', '-') as prefix,
-       trim(leading 'I- USMN' from split_part(ref, ';', 1)) as tref,
-       char_length(trim(leading 'I- USMN' from split_part(ref,';',1))) as tlength
+       trim(leading 'I- USMNCRTH' from split_part(ref, ';', 1)) as tref,
+       char_length(trim(leading 'I- USMNCRTH' from split_part(ref,';',1))) as tlength
        from &prefix;_roads
        where highway in ('motorway','trunk','primary')
          and ref is not null
@@ -6490,8 +6334,8 @@
       <Parameter name="table">
       (select way,highway,aeroway,name,ref,char_length(ref) as length,
        replace(substring(ref for 2), ' ', '-') as prefix,
-       trim(leading 'I- USMN' from split_part(ref, ';', 1)) as tref,
-       char_length(trim(leading 'I- USMN' from split_part(ref,';',1))) as tlength,
+       trim(leading 'I- USMNCRTH' from split_part(ref, ';', 1)) as tref,
+       char_length(trim(leading 'I- USMNCRTH' from split_part(ref,';',1))) as tlength,
        case when bridge in ('yes','true','1') then 'yes'::text else bridge end as bridge
        from &prefix;_line
        where waterway IS NULL
