<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<!DOCTYPE svg PUBLIC '-//W3C//DTD SVG 1.1//EN'
	  'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'>
<svg id='meter_undercount'
     width='560' height='480' version='1.1'
     xmlns='http://www.w3.org/2000/svg'
     xmlns:xlink='http://www.w3.org/1999/xlink'>
<rect style='fill:#f6f6ff;stroke:black;stroke-width:2'
      x='60' y='60' width='480' height='360'/>
<path style='fill:none;stroke:gray;stroke-width:0.25'
      d='M500 420L500 60M460 420L460 60M420 420L420 60M380 420L380 60M340 420
	 L340 60M300 420L300 60M260 420L260 60M220 420L220 60M180 420L180 60
	 M140 420L140 60M100 420L100 60'/>
<text style='font-size:24px' x='112' y='40'>Demand Undercount Correction</text>
<path id='volume_text'
      d='M40 320L40 60'/>
<text style='font-size:16px'>
  <textPath xlink:href='#volume_text'>Volume (Vehicles)</textPath>
</text>
<text style='font-size:16px' x='260' y='470'>Time (Steps)</text>
<text style='font-size:12px'>
  <tspan x='100' y='440'>t-12</tspan>
  <tspan x='140' y='440'>t-10</tspan>
  <tspan x='180' y='440'>t-8</tspan>
  <tspan x='220' y='440'>t-6</tspan>
  <tspan x='260' y='440'>t-4</tspan>
  <tspan x='300' y='440'>t-2</tspan>
  <tspan x='340' y='440'>t</tspan>
  <tspan x='380' y='440'>t+2</tspan>
  <tspan x='420' y='440'>t+4</tspan>
  <tspan x='460' y='440'>t+6</tspan>
  <tspan x='500' y='440'>t+8</tspan>
</text>
<path style='fill:#ffd2d2;stroke:#003373;stroke-dasharray:1,2'
      d='M340 90L320 110 300 140 280 160 300 150 320 130 340 120'/>
<path style='fill:#def;stroke:#003373'
      d='M340 120L320 130 300 150 280 160 260 170 240 180 220 200 200 240
	 180 270 160 300 140 310 120 350 100 380 60 420 100 380 120 370
	 140 350 180 320 220 290 260 270 300 260 340 240'/>
<text style='font-size:8px' x='100' y='390'>start metering</text>
<path id='queue_length'
      style='fill:none;stroke:black;stroke-dasharray:1,3'
      d='M340 240L340 120'/>
<text style='font-size:8px' transform='translate(-2,-32)'>
  <textPath xlink:href='#queue_length'>queue length</textPath>
</text>
<path id='queue_demand'
      style='fill:none'
      d='M160 270L260 120'/>
<text style='font-size:12px'>
  <textPath xlink:href='#queue_demand'>queue demand (input)</textPath>
</text>
<path id='metering_rate'
      style='fill:none'
      d='M180 310L340 210'/>
<text style='font-size:12px'>
  <textPath xlink:href='#metering_rate'>metering rate (output)</textPath>
</text>
<path id='max_storage'
      style='fill:none'
      d='M350 150L350 90'/>
<text style='font-size:8px'>
  <textPath xlink:href='#max_storage'>max storage</textPath>
</text>
<path style='fill:none;stroke:#b10000;stroke-dasharray:1,3'
      d='M280 90L340 90'/>
<text style='font-size:8px' x='292' y='88'>duration</text>
<rect style='fill:white;stroke:black'
      x='360' y='160' width='160' height='110' ry='10'/>
<text style='font-size:11px' x='380' y='180'>
  <tspan x='380' y='180'>When queue occupancy</tspan>
  <tspan x='380' y='192'>is above 25% threshold,</tspan>
  <tspan x='380' y='204'>assume the detector is</tspan>
  <tspan x='380' y='216'>undercounting.  Increase</tspan>
  <tspan x='380' y='228'>queue demand gradually</tspan>
  <tspan x='380' y='240'>until queue length is</tspan>
  <tspan x='380' y='252'>equal to max storage.</tspan>
</text>
<rect style='fill:white;stroke:black'
      x='320' y='310' width='200' height='90' ry='10'/>
<text style='font-size:11px' x='340' y='330'>
  <tspan x='340' y='330'>duration (of occupancy spike)</tspan>
  <tspan x='340' y='342'/>
  <tspan x='340' y='354'>r = 2 * duration / max wait</tspan>
  <tspan x='340' y='366'>v = max storage - queue len</tspan>
  <tspan x='340' y='378'>demand += max(r * v, 1)</tspan>
</text>
</svg>
