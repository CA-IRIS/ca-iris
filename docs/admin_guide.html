<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8" name="Author" content="Douglas Lau"/>
	<link href="iris_doc.css" rel="stylesheet" type="text/css"/>
	<title>IRIS Administrator Guide</title>
	<script type="text/javascript" src="admin_guide.js"></script>
</head>

<body>
<div class="sidebar">
  <h1><a id="contents_link" href="#admin_guide">Contents</a></h1>
  <div id="contents_div"><!-- div required for js, DO NOT REMOVE --></div>
  <h2><a id="overview_link" href="#overview">Overview</a></h2>
  <div id="overview_div">
    <h3><a href="#architecture">System Architecture</a></h3>
    <h3><a href="#device_types">Device Types</a></h3>
    <h3><a href="#protocols">Protocols</a></h3>
    <h3><a href="#advanced_features">Advanced Features</a></h3>
  </div>
  <h2><a id="installation_link" href="#installation">Installation</a></h2>
  <div id="installation_div">
    <h3><a href="#operating_system">Operating System</a></h3>
    <h3><a href="#install_iris">Install IRIS</a></h3>
    <h3><a href="#init_iris">Initialize IRIS</a></h3>
    <h3><a href="#server_properties">Server Properties</a></h3>
    <h3><a href="#start_services">Start Services</a></h3>
    <h3><a href="#initial_login">Initial Login</a></h3>
  </div>
  <h2><a id="basic_setup_link" href="#basic_setup">Basic Setup</a></h2>
  <div id="basic_setup_div">
    <h3><a href="#system_attributes">System Attributes</a></h3>
    <h3><a href="#client_properties">Client Properties</a></h3>
    <h3><a href="#user_properties">User Properties</a></h3>
    <h3><a href="#users_and_roles">Users and Roles</a></h3>
    <h3><a href="#mapping">Mapping</a></h3>
    <h3><a href="#road_topology">Road Topology</a></h3>
    <h3><a href="#comm_links">Comm Links</a></h3>
    <h3><a href="#controllers">Controllers</a></h3>
    <h3><a href="#fonts">Fonts</a></h3>
  </div>
  <h2><a id="devices_link" href="#devices">Devices</a></h2>
  <div id="devices_div">
    <h3><a href="#dms">Dynamic Message Signs</a></h3>
    <h3><a href="#cameras">Cameras</a></h3>
    <h3><a href="#vds">Vehicle Detection</a></h3>
    <h3><a href="#lcs">Lane-Use Control Signs</a></h3>
    <h3><a href="#ramp_meters">Ramp Meters</a></h3>
    <h3><a href="#gate_arms">Gate Arms</a></h3>
    <h3><a href="#beacons">Beacons</a></h3>
    <h3><a href="#alarms">Alarms</a></h3>
    <h3><a href="#rwis">Road Weather Information Systems</a></h3>
    <h3><a href="#lane_marking">Lane Marking</a></h3>
  </div>
  <h2><a id="features_link" href="#features">Features</a></h2>
  <div id="features_div">
    <h3><a href="#traffic_layer">Traffic Map Layer</a></h3>
    <h3><a href="#incident_management">Incident Management</a></h3>
    <h3><a href="#action_plans">Action Plans</a></h3>
    <h3><a href="#schedules">Date/Time Schedules</a></h3>
    <h3><a href="#metering_strategies">Ramp Metering Strategies</a></h3>
    <h3><a href="#travel_time">Travel Time Estimation</a></h3>
    <h3><a href="#vsa">Variable Speed Advisory</a></h3>
  </div>
  <h2><a id="troubleshooting_link" href="#troubleshooting">Troubleshooting</a></h2>
  <div id="troubleshooting_div">
    <h3><a href="#error_logs">Error Logs</a></h3>
    <h3><a href="#xml_output">Realtime XML Output</a></h3>
    <h3><a href="#event_tables">Database Event Tables</a></h3>
    <h3><a href="#debug_logs">Debug Trace Logs</a></h3>
  </div>
  <h2><a id="maintenance_link" href="#maintenance">Maintenance</a></h2>
  <div id="maintenance_div">
    <h3><a href="#database_backups">Database Backups</a></h3>
    <h3><a href="#iris_upgrades">IRIS Upgrades</a></h3>
    <h3><a href="#system_updates">System Software Updates</a></h3>
    <h3><a href="#monitoring_logs">Monitoring Logs</a></h3>
  </div>
  <h2><a id="development_link" href="#development">Development</a></h2>
  <div id="development_div">
    <h3><a href="#building">Building</a></h3>
    <h3><a href="#history">History</a></h3>
    <h3><a href="#future_plans">Future Plans</a></h3>
    <h3><a href="#contributing">Contributing</a></h3>
    <h3><a href="#coding_style">Coding Style</a></h3>
  </div>
</div>

<div class="mainbar">
<div id="stamp">30 Dec 2014</div>
<h1 id="admin_guide"><span class="left"><img src="iris_icon.svg"/></span>
	IRIS Administrator Guide</h1>

<h2 id="overview">Overview</h2>
<p>
	IRIS is an <a href="http://www.opensource.org/docs/osd">open source</a>
	advanced traffic management system.
	It provides an integrated platform for transportation agencies to
	manage traffic monitoring and control devices.
	The software is written in <a href="http://www.java.com">Java</a> and
	licensed for anyone to use under the
	<a href="http://www.gnu.org/licenses/old-licenses/gpl-2.0.html">GPL</a>.
	In addition, all dependencies required to install and operate an IRIS
	system are available as free software.
	IRIS stands for Intelligent Roadway Information System.
</p>
<p>
	The IRIS software presents an intuitive map-based interface to system
	operators.
	This user interface has been refined over many iterations by getting
	feedback from operators to streamline their workflow.
</p>

<h3 id="architecture">System Architecture</h3>

<svg class="right" xmlns="http://www.w3.org/2000/svg" version="1.1"
     width="640" height="480">
  <title>System Architecture</title>
  <defs>
    <marker id="Arrow1Mend" orient="auto" style="overflow:visible">
      <path d="M 0,0 5,-5 -12.5,0 5,5 0,0 z"
            transform="matrix(-0.4,0,0,-0.4,-4,0)"
            style="stroke:#000;stroke-width:1pt;marker-start:none"/>
    </marker>
  </defs>
  <g style="font-size:20px;font-family:Liberation Sans">
    <text style="font-size:28px">
      <tspan x="384" y="64">IRIS System</tspan>
      <tspan x="384" y="94">Architecture</tspan>
    </text>
    <g transform="translate(112,24)">
      <g style="fill:#c4f9ff;stroke:#000;stroke-width:2">
        <g style="opacity:0.5">
          <rect x="16" y="16" width="200" height="88" ry="8"
                style="opacity:0.5"/>
          <rect x="8" y="8" width="200" height="88" ry="8"/>
        </g>
        <rect x="0" y="0" width="200" height="88" ry="8"/>
      </g>
      <text>
        <tspan x="48" y="48">IRIS Clients</tspan>
      </text>
    </g>
    <g transform="translate(16,176)">
      <rect x="0" y="0" width="176" height="104" ry="8"
        style="fill:#ffe6c4;stroke:#000;stroke-width:2"/>
      <text>
        <tspan x="16" y="40">Apache Server</tspan>
        <tspan x="24" y="60">- Client JARs</tspan>
        <tspan x="24" y="80">- Map Tiles</tspan>
      </text>
    </g>
    <g transform="translate(232,176)">
      <rect x="0" y="0" width="192" height="120" ry="8"
            style="fill:#e2c4ff;stroke:#000;stroke-width:2"/>
      <text>
        <tspan x="40" y="60">IRIS Server</tspan>
      </text>
    </g>
    <g transform="translate(464,188)">
      <rect x="0" y="0" width="160" height="108" ry="8"
        style="fill:#d0ffc4;stroke:#000;stroke-width:2"/>
      <text>
        <tspan x="16" y="40">Authentication</tspan>
        <tspan x="16" y="60">Server (LDAP)</tspan>
        <tspan x="32" y="80" style="font-style:italic">(Optional)</tspan>
      </text>
    </g>
    <g transform="translate(96,360)">
      <g style="fill:#f6ffc4;stroke:#000;stroke-width:2">
        <g style="opacity:0.5">
          <rect x="16" y="16" width="208" height="88" ry="8"
                style="opacity:0.5"/>
          <rect x="8" y="8" width="208" height="88" ry="8"/>
        </g>
        <rect x="0" y="0" width="208" height="88" ry="8"/>
      </g>
      <text>
        <tspan x="16" y="40">Traffic Monitoring</tspan>
        <tspan x="16" y="60">and Control Devices</tspan>
      </text>
    </g>
    <g transform="translate(368,360)">
      <rect x="0" y="0" width="152" height="88" ry="8"
        style="fill:#c4d1ff;stroke:#000;stroke-width:2" />
      <text>
        <tspan x="16" y="40">Database</tspan>
        <tspan x="16" y="60">(PostgreSQL)</tspan>
      </text>
    </g>
    <g style="stroke:#000;stroke-width:2;marker-end:url(#Arrow1Mend)">
      <path d="m 176,112 -32,64"/>
      <path d="m 256,112 32,64"/>
      <path d="m 424,240 40,8"/>
      <path d="m 272,296 -32,64"/>
      <path d="m 368,296 32,64"/>
    </g>
  </g>
</svg>

<p>
	The software has a client/server architecture.
	System configuration data is stored in a
	<a href="http://www.postgresql.org">PostgreSQL</a> database,
	and managed by the IRIS server.
	The server also handles communication with all traffic control and
	data collection devices.
	The client software is distributed by an <a
	href="http://projects.apache.org/projects/http_server.html">Apache</a>
	web server, using Java Web Start.
	All communication between the server and clients is encrypted using
	secure socket layer (SSL).
	The server may be configured to pass authentication requests off to an
	external LDAP server, allowing IRIS to integrate into an existing
	authentication system.
</p>

<h3 id="device_types">Device Types</h3>
<p>
	IRIS is able to manage several different types of traffic monitoring and
	control devices.
	These include:
</p>
<ul>
	<li><a href="#dms">DMS</a> (dynamic message signs)</li>
	<li><a href="#cameras">CCTV cameras</a> and
	    <a href="#video">Video switchers</a>
	</li>
	<li><a href="#vds">VDS</a> (vehicle detection systems)</li>
	<li><a href="#lcs">LCS</a> (lane-use control signs)</li>
	<li><a href="#ramp_meters">Ramp meters</a></li>
	<li><a href="#gate_arms">Gate Arms</a></li>
	<li><a href="#beacons">Beacons</a></li>
	<li><a href="#rwis">RWIS</a> (road-weather information systems)</li>
	<li><a href="#lane_marking">In-road lighting</a> (dynamic striping)</li>
</ul>
<h3 id="protocols">Protocols</h3>
<p>
	Many different protocols are supported for communicating with the
	various device types.
	Additional protocols can be added for any existing device type by
	programming a simple driver interface.
	These are some existing protocols:
</p>
<ul>
	<li>NTCIP class A, B and C (DMS)</li>
	<li>DMS-XML (DMS)</li>
	<li>MnDOT 4- and 5-bit (VDS, ramp meters, LCS, beacons, IRL)</li>
	<li>Wavetronix SS105 and SS125 (VDS)</li>
	<li>Canoga Traffic Sensing System (VDS)</li>
	<li>RTMS G4 (VDS)</li>
	<li>Pelco D (pan/tilt/zoom)</li>
	<li>Infinova (pan/tilt/zoom)</li>
	<li>Cohu (pan/tilt/zoom)</li>
	<li>AD "manchester" (pan/tilt/zoom)</li>
	<li>Vicon (pan/tilt/zoom)</li>
	<li>Msg Feed (external system DMS messages)</li>
	<li>Pelco Video Switcher</li>
	<li>HySecurity STC (Gate Arms)</li>
	<li>Optical Scientific ORG-815 (precipitation)</li>
	<li>SSI RWIS sensor</li>
	<li>DLI DIN Relay (LCS)</li>
</ul>
<h3 id="advanced_features">Advanced Features</h3>
<p>
	IRIS also contains some higher-level traffic management features:
</p>
<ul>
	<li>Continuously updated traffic map (density, speed or flow)</li>
	<li>Scheduled deployment of control devices</li>
	<li>Incident management</li>
	<li>Travel time estimation for traveler information</li>
	<li>Variable speed advisories</li>
	<li>Coordinated ramp metering strategies</li>
</ul>

<h2 id="installation">Installation</h2>
<p/>

<h3 id="operating_system">Operating System</h3>
<p>
	Install <a href="http://fedoraproject.org">Fedora</a> onto the server
	computer.
	Other operating systems, such as Red Hat Enterprise Linux, can also be
	used, but the procedures may vary slightly.
	This machine should have a minimum of 2 GB of RAM and 200 GB hard drive
	storage space.
	The IRIS server does not have a GUI interface, so this computer can be
	set up headless.
</p>
<p>
	After the operating system is installed, make sure the hostname is
	configured correctly in DNS.
	The hostname is needed for some configuration files in the following
	steps.
	The following command should display the hostname that can be used to
	access the server:
</p>
<pre class="code">hostname -f</pre>

<h3 id="install_iris">Install IRIS</h3>
<p>
	<a href="http://iris.dot.state.mn.us/rpms/">Download</a> and install
	the IRIS package.
	This should be a file called
	<b>iris-<i>{major}</i>.<i>{minor}</i>.<i>{micro}</i>-<i>{build}</i>.<i>{arch}</i>.rpm</b>.
	The <i>{major}</i>, <i>{minor}</i>, and <i>{micro}</i> version numbers
	and the <i>{build}</i> number can change with each release.
	The system architecture, <i>{arch}</i>, will be <i>noarch</i>,
	since Java is architecture independent.
	It can be installed with the following command (as root):
</p>
<pre class="code">yum install iris-<i>{major}</i>.<i>{minor}</i>.<i>{micro}</i>-<i>{build}</i>.noarch.rpm</pre>
<p>
	Yum will install dependencies not already installed, including
	<a href="http://openjdk.java.net">OpenJDK</a>,
	<a href="http://www.postgresql.org">PostgreSQL</a> and
	<a href="http://projects.apache.org/projects/http_server.html">Apache</a>.
</p>
<h3 id="init_iris">Initialize IRIS</h3>
<p>
	Next, you must initialize the IRIS server installation.
	Run the following command (as root):
</p>
<pre class="code">iris_ctl init</pre>
<p>
	This command will perform the following steps:
</p>
<ol>
	<li>
		Update the <code>/etc/iris/iris-client.properties</code> file
		with the server's hostname.
	</li>
	<li>
		Create an SSL key pair for encrypted communication between the
		server and clients.
		The keystore files are
		<code>/etc/iris/iris-server.keystore</code> and
		<code>/etc/iris/iris-client.keystore</code>.
		The keystore passwords are put into
		<code>/etc/iris/iris-server.properties</code> and
		<code>/etc/iris/iris-client.properties</code>.
	</li>
	<li>
		Create a symbolic link to the PostgreSQL JDBC driver to make it
		available to the IRIS server.
	</li>
	<li>
		Create the database cluster and start the PostgreSQL server.
	</li>
	<li>
		Create the "tms" PostgreSQL user, which IRIS uses to connect
		to the database.
	</li>
	<li>
		Create the "tms" database and populate it using a template
		SQL script.
	</li>
	<li>
		Configure the apache (httpd) and IRIS services to start
		automatically.
	</li>
	<li>
		Create symbolic links to the current IRIS software version.
	</li>
</ol>
<p>
	The command should finish with the following message:
</p>
<pre>Successfully initialized the IRIS server</pre>

<h3 id="server_properties">Server Properties</h3>
<p>
	The IRIS server has a configuration file which controls some of its
	basic settings &mdash; <i>/etc/iris/iris-server.properties</i>.
	Most of the default settings should work, but it may be necessary to
	make some changes.
	The file can be modified using a text editor, such as <i>gedit</i> or
	<i>vi</i>.
</p>
<h4>Internationalization</h4>
<p>
	There are three properties which control internationalization (i18n).
	They are <i>language</i>, <i>country</i> and <i>variant</i>.
	These should only be changed if the IRIS software has been localized
	for a specific locale.
</p>
<h4 id="district">District</h4>
<p>
	This property is used when multiple IRIS servers are running within the
	same organization.
</p>
<h4>HTTP Proxy</h4>
<p>
	These properties can be used when IRIS must connect to HTTP servers
	using a proxy server, due to organization firewall policies.
</p>
<h4>Database Connection</h4>
<p>
	The <i>db.url</i>, <i>db.user</i> and <i>db.password</i> properties
	control how the IRIS server connects to the PostgreSQL database.
	None of these properties should be changed, since they were configured
	earlier by the <code>iris_ctl</code> script.
</p>
<h4 id="sonar_config">SONAR Configuration</h4>
<p>
	The <i>sonar.ldap.urls</i> property can be used to let IRIS pass user
	authentication requests to one or more LDAP servers.
	Multiple URLs must be separated by a space.
	IRIS can manage user accounts and passwords without an LDAP server, but
	this feature allows operators to log into IRIS without requiring them to
	remember an additional user name and password.
	If your organization already has an LDAP server, such as Active
	Directory, you should use that.
</p>
<p>
	The URL protocol is normally <i>ldap:</i>, but must be <i>ldaps:</i>
	for encrypted communication over SSL.
	To use ldaps, you must first import the SSL certificate into the IRIS
	keystore.
	Once you have obtained the SSL certificate for the LDAP server, save it
	as <i>ldap.cert</i>.
	Now you can import it with the following command (as root):
</p>
<pre class="code">keytool -import -alias ldap-cert -keystore /etc/iris/iris-server.keystore -file ldap.cert</pre>
<p>
	The <i>keystore.password</i> is used for accessing keys in
	<code>/etc/iris/iris-server.keystore</code>.
	This password is automatically generated by the <code>iris_ctl</code>
	script.
	It will not need to be changed.
</p>

<h3 id="start_services">Start Services</h3>
<p>
	Finally, the IRIS server can now be started with the following command:
</p>
<pre class="code">systemctl start iris.service</pre>
<p>
	Check that everything started OK:
</p>
<pre class="code">tail -f -n 40 /var/log/iris/iris.stderr</pre>

<h3 id="initial_login">Initial Login</h3>
<p>
	From a client computer with Java installed, point your web browser at
	http://YOUR_SERVER_NAME/iris-client/.
	From there, you should be able to launch the IRIS client Web Start
	application and log in.
</p>
<p>
	Enter <code>admin</code> as the username and <code>atms_242</code> as
	the password for the initial login.
	After <a href="#users_and_roles">creating</a> and logging in with a
	real administrator account, the <code>admin</code> user account should
	be disabled.
</p>

<h2 id="basic_setup">Basic Setup</h2>
<br/>

<h3 id="system_attributes">System Attributes</h3>
<p>
	A <b>system attribute</b> is a configurable value which can be used to
	customize an IRIS system.
	Select the <span class="menu">View ➔ System ➔ System Attributes</span>
	menu item to display the System Attributes form.
	Each system attribute has a corresponding type: string, boolean,
	integer or floating point number.
	String values are limited to 64 characters or less.
	Boolean values must be specified as either "true" or "false".
	Many numeric system attributes are constrained to a range of values
	within a minimum and maximum bound, depending on the attribute.
	A system attribute can be customized by updating the value in the table
	on the System Attributes form.
	When a system attribute has been modified from its default value, it
	will be displayed <b>in bold</b>.
	Most attribute changes take effect immediately, but some require the
	IRIS client or server to be restarted. Some System Attributes are
	described in more detail below.
</p>

<h4 id="system_attributes">map_segment_max_meters</h4>
<p>
	This is used for two distinct purposes: 1) specifying the maximum
	distance between adjacent stations to draw segments on the map and
	2) specifying the maximum distance from a station to another downstream
	station for associating density, speed, etc. data with a segment.
</p>

<h3 id="client_properties">Client Properties</h3>
<p>
	The IRIS client has a configuration file (stored on the server) which
	controls some of its basic settings &mdash;
	<i>/etc/iris/iris-client.properties</i>.
	It can also contain default values for some
	<a href="#user_properties">user properties</a> that will be used in the
	event that they are unspecified in the user properties file.
</p>
<dl>
	<dt>language</dt>
	<dd>
		ISO 639 alpha-2 or alpha-3 language code.
		E.g., "en", "es", "fr".
	</dd>
	<dt>country</dt>
	<dd>
		ISO 3166 alpha-2 country code or UN M.49 numeric-3 area code.
		E.g., "US", "MX", "CA".
	</dd>
	<dt>variant</dt>
	<dd>
		IETF BCP 47 language variant subtag.
	</dd>
	<dt>district</dt>
	<dd>
		District name.
		Useful in cases where multiple IRIS servers exist within the
		same organization.
	</dd>
	<dt>proxy.host</dt>
	<dd>
		If a proxy is to be used, its hostname can be specified here.
	</dd>
	<dt>proxy.port</dt>
	<dd>
		If a proxy is to be used, its port number can be specified here.
	</dd>
	<dt>no.proxy.hosts</dt>
	<dd>
		A comma-separated list of host IPs/subnets to exclude from proxy
		use.
	</dd>
	<dt>keystore.file</dt>
	<dd>
		URL for the client keystore file.
	</dd>
	<dt>keystore.password</dt>
	<dd>
		Password for the client keystore.
	</dd>
	<dt>sonar.host</dt>
	<dd>
		IP or hostname of the SONAR server.
	</dd>
	<dt>sonar.port</dt>
	<dd>
		TCP port number of the SONAR server.
	</dd>
	<dt>tdxml.detector.url</dt>
	<dd>
		URL for XML detector stream.
	</dd>
	<dt>map.tile.url</dt>
	<dd>
		Base URL for map tileset.
		Must end in "/".
	</dd>
	<dt>video.host</dt>
	<dd>
		IP or hostname of video server/proxy.
	</dd>
	<dt>video.port</dt>
	<dd>
		TCP port number of video server/proxy.
	</dd>
	<dt>autologin.username</dt>
	<dd>
		A username to be used for automatic login upon client startup.
		As this is a global client property, it is generally not useful
		in production environments.
	</dd>
	<dt>autologin.password</dt>
	<dd>
		A password to be used for automatic login upon client startup.
		As this is a global client property, it is generally not useful
		in production environments.
	</dd>
</dl>

<h3 id="user_properties">User Properties</h3>
<p>
	The IRIS client also maintains a file that is used to store client
	state and user/machine-specific preferences.
	If this file doesn't exist, the IRIS client will automatically create
	it.
	The file is named "user.properties", and can be found in the "iris"
	folder of the user's home directory.
	Many of the properties stored in this file are used for the preservation
	of client UI state (e.g., window geometry, last-selected tab), but
	others are useful for overriding various defaults:
</p>
<dl>
	<dt>tab.list</dt>
	<dd>
		A comma-separated list (whitespace ignored) that specifies the
		visibility and ordering of the primary UI tabs in the IRIS
		client.
		If unspecified, the following default value is used:
		<blockquote><code>
			incident, dms, camera, lcs, ramp.meter,
			gate.arm, r_node, action.plan, comm
		</code></blockquote>
	</dd>
</dl>

<h3 id="users_and_roles">Users and Roles</h3>
<p>
	When a user logs into the IRIS system, the user is checked for validity.
	The user account must be enabled, and be assigned to an enabled
	<b>role</b> for a log in to succeed.
	If the user has a "distinguished name" (dn), then authentication is
	performed using <a href="#sonar_config">LDAP</a>.
	Otherwise, IRIS checks the password against the stored password hash
	for that user account.
	Select the <span class="menu">View ➔ System ➔ Users and Roles</span>
	menu item to display the <b>Users and Roles</b> form.
</p>
<p>
	The template SQL database contains one administrator role, called
	<code>admin</code>.
	This role is assigned <b>capabilities</b> which allow unfettered access
	to the IRIS system.
	Other roles can be created by an administrator, to allow users with a
	specific set of capabilities, as needed.
	For example, there are capabilities defined for each of the main tabs
	on the user interface: camera_tab, dms_tab, lcs_tab, meter_tab, etc.
	Also, these capabilities can be disabled, preventing any user from
	having access to them.
	So, if a system does not contain any LCS devices, the lcs_tab capability
	could be disabled globally, to prevent that tab from appearing in the
	user interface for any users.
	WARNING: changes take effect immediately &mdash; if the user_admin
	capability is disabled or removed from the administrator role, the
	administrator will lose access to change roles and capabilities.
</p>

<h3 id="mapping">Mapping</h3>
<p>
	The IRIS client can use map tiles to display high-quality maps as a
	background layer.
	The map tiles are fetched from a web server on demand as the client map
	is panned and zoomed.
	The tiles can be generated from data downloaded from
	<a href="http://openstreetmap.org">OpenStreetMap</a>.
	The following instructions describe one method of generating the map
	tiles on Fedora 20.
</p>

<h4>Get planet file</h4>
<p>
	Download the latest planet file (about 32GB).
<pre class="code">wget http://planet.openstreetmap.org/planet/planet-latest.osm.bz2</pre>
</p>

<h4>Download and install PostGIS</h4>
<p>
<pre class="code">sudo yum install postgis postgis-docs postgis-utils</pre>
</p>

<h4>Configure PostGIS and create spatial DB</h4>
<p>
<pre class="code">
# Create DB named gis
su - postgres
createdb --encoding=UTF8 gis
psql -d gis -f /usr/share/pgsql/contrib/postgis-64.sql

# Edit kernel parameters to increase max size of shared memory
sudo sysctl -w kernel.shmmax=268435456
sudo sysctl -p /etc/sysctl.conf
sysctl -a | grep kernel.shmmax

# Update postgresql config
vim /var/lib/pgsql/data/postgresql.conf
	checkpoint_segments = 20
	maintenance_work_mem = 256MB # 256000 for 8.1 and earlier
	autovacuum = off
	shared_buffers = 4GB
	temp_buffers = 128MB
	maintenance_work_mem = 4GB 
service postgresql restart
</pre>
</p>

<h4>Build and install osm2pgsql from source</h4>
<p>
<pre class="code">
su - tms
sudo yum -y install git
sudo yum -y install geos-devel proj-devel postgresql-devel libxml2-devel bzip2-devel 
sudo yum -y install gcc-c++ protobuf-c-devel autoconf automake libtool
mkdir ~/osm; cd ~/osm
git clone https://github.com/openstreetmap/osm2pgsql.git
cd ~/osm/osm2pgsql
./autogen.sh
./configure 
make
sudo make install
</pre>
</p>

<h4>Import OSM planet file into PostGIS</h4>
<p>
	This process takes a long time (around 30 hours). See performance comparisons 
	<a href="http://wiki.openstreetmap.org/wiki/Osm2pgsql/benchmarks">here</a>. 
	Determine the bounding box for the region of interest. For Minnesota it 
	is: -97.5, 43.0, -89.0, 49.5.
</p>
<pre class="code">
su - postgres
osm2pgsql -v --number-processes=16 -d gis -s --bbox -97.5, 43.0, -89.0, 49.5 planet-140522.osm.bz2
</pre>


<h4>Build and install mapnik library from source</h4>
<p>
	See the mapnik <a href="https://github.com/mapnik/mapnik/wiki/Mapnik-Installation">install docs</a>. The <a href="https://gist.github.com/springmeyer/3427021">Springmeyer docs</a> are also very useful.
</p>
<pre class="code">
su - tms
# Install dependencies
sudo yum -y install make gcc47 gcc-c++ bzip2-devel libpng-devel libtiff-devel \
      zlib-devel libjpeg-devel libxml2-devel python-setuptools git-all \
      python-nose python27-devel python27 proj-devel proj proj-epsg \
      proj-nad freetype-devel freetype libicu-devel libicu
# Install optional deps
sudo yum -y install gdal-devel gdal postgresql-devel sqlite-devel sqlite \
      libcurl-devel libcurl cairo-devel cairo pycairo-devel pycairo
# Build recent version of Boost
export JOBS=`grep -c ^processor /proc/cpuinfo`
mkdir -p ~/osm/src; cd ~/osm/src
export BOOST_VERSION="1_55_0"
export S3_BASE="http://mapnik.s3.amazonaws.com/deps"
curl -O ${S3_BASE}/boost_${BOOST_VERSION}.tar.bz2
tar xf boost_${BOOST_VERSION}.tar.bz2
cd boost_${BOOST_VERSION}
./bootstrap.sh
./b2 -d1 -j${JOBS} \
    --with-thread \
    --with-filesystem \
    --with-python \
    --with-regex -sHAVE_ICU=1  \
    --with-program_options \
    --with-system \
    link=shared \
    release \
    toolset=gcc \
    stage
sudo ./b2 -j${JOBS} \
    --with-thread \
    --with-filesystem \
    --with-python \
    --with-regex -sHAVE_ICU=1 \
    --with-program_options \
    --with-system \
    toolset=gcc \
    link=shared \
    release \
    install
cd ~/osm/src
# Set up support for libraries installed in /usr/local/lib
sudo bash -c "echo '/usr/local/lib' > /etc/ld.so.conf.d/boost.conf"
sudo ldconfig
# Build and install mapnik stable branch: 2.3.x
mkdir -p ~/osm/src; cd ~/osm/src
git clone https://github.com/mapnik/mapnik -b 2.3.x
cd ~/osm/src/mapnik
./configure
make
make test-local
sudo make install
# Verify everything is good
echo “import mapnik” | python
</pre>

<h4>Install mapnik tools</h4>
<p>
	See <a href="https://github.com/mapnik/mapnik/blob/v2.2.0/INSTALL.md">docs</a>.
</p>
<pre class="code">
sudo yum -y install svn
cd ~/osm
svn export http://svn.openstreetmap.org/applications/rendering/mapnik
# Install prepared world boundary data
cd ~/osm/mapnik
mkdir world_boundaries
wget http://tile.openstreetmap.org/world_boundaries-spherical.tgz
tar xvzf world_boundaries-spherical.tgz
wget http://tile.openstreetmap.org/processed_p.tar.bz2
tar xvjf processed_p.tar.bz2 -C world_boundaries
wget http://tile.openstreetmap.org/shoreline_300.tar.bz2
tar xjf shoreline_300.tar.bz2 -C world_boundaries
wget http://www.naturalearthdata.com/http//www.naturalearthdata.com/download/10m/cultural/ne_10m_populated_places.zip
unzip ne_10m_populated_places.zip -d world_boundaries
wget http://www.naturalearthdata.com/http//www.naturalearthdata.com/download/110m/cultural/ne_110m_admin_0_boundary_lines_land.zip
unzip ne_110m_admin_0_boundary_lines_land.zip  -d world_boundaries
</pre>

<h4>Patch osm.xml to create iris_osm.xml</h4>
<pre class="code">
cd ~/osm/mapnik/
cp osm.xml iris_osm.xml
patch -p0 &lt; ../01_drop_junc_power_layers.patch
patch -p0 &lt; ../02_interstate_shields.patch
patch -p0 &lt; ../03_trunk_shields.patch
patch -p0 &lt; ../04_cty_rd_shields.patch
patch -p0 &lt; ../05_motorway_color.patch
patch -p0 &lt; ../06_trunk_color.patch
patch -p0 &lt; ../07_primary_color.patch
patch -p0 &lt; ../08_secondary_color.patch
patch -p0 &lt; ../09_tertiary_color.patch
</pre>

<h4>Copy symbols used for roadway shields</h4>
<p>
	FIXME
</p>

<h4>Generate tiles</h4>
<p>
	Generating tiles takes about 2 hours on a 16 processor system, or about 13K tiles/min.
</p>
<pre class="code">
su - tms
cd ~/osm/mapnik
export MAPNIK_MAP_FILE=~/osm/mapnik/iris_osm.xml
export MAPNIK_TILE_DIR=/home/tms/osm/tiles
# Customize osm.xml
./generate_xml.py  --dbname gis --accept-none
vim generate_tiles_multiprocess.py
	NUM_THREADS = number of processors in your server
	bbox = (-97.5, 43.0, -89.0, 49.5)
	minZoom = 6
	maxZoom = 16
	# comment all of the european cities listed
timer ./generate_tiles_multiprocess.py
# Copy tiles to server hosting them
scp -rp ~/osm/tiles/* root@tilehost:/var/www/html/
</pre>

<h4>Create Map Extents in IRIS database</h4>
<p>
	In the IRIS client, select the <span class="menu">View ➔ System ➔
	Map Extents</span> menu item to bring up the Map Extents form.
	This form enables the creation of map extents, which are buttons
	allowing quick selection of a map location and zoom level.
	Each map extent will be displayed as a button on the upper right area
	of the map (next to the zoom in/out buttons).
	First, a "Home" extent should be created, which is selected by default
	when a user logs in.
	Other extents can also be created for commonly selected map spots.
</p>

<h3 id="road_topology">Road Topology</h3>
<svg class="right" width='240' height='480'
     xmlns="http://www.w3.org/2000/svg" version="1.1"
     xmlns:xlink='http://www.w3.org/1999/xlink'>
  <title>R_Nodes</title>
<defs>
  <g id='r_node_marker' style='fill:lime;stroke:black;stroke-width:2'>
    <circle cx='0' cy='0' r='10'/>
    <path d='M-8-8L8 8'/>
    <path d='M-8 8L8-8'/>
  </g>
</defs>
<path d='M6 0L6 480 120 480 120 406C124 408 128 432 172 480L236 480
	 C196 448 150 368 120 288L120 208C128 168 214 50 236 0L172 0
	 C168 12 120 80 120 88L120 0Z'/>
<path style='fill:none;stroke:white;stroke-dasharray:10,20;stroke-width:4'
      d='M64 8L64 480'/>
<path style='fill:none;stroke:yellow;stroke-width:4'
      d='M16 0L16 480M112 368C118 404 168 468 180 480M180 0
	 C180 8 128 80 112 120'/>
<path style='fill:none;stroke:white;stroke-width:4'
      d='M112 0L112 122M228 0C196 64 145 128 112 200L112 288
	 C144 373 189 448 228 480M112 368L112 480'/>
<use x='112' y='32' xlink:href='#r_node_marker'/>
<use x='112' y='120' xlink:href='#r_node_marker'/>
<use x='112' y='240' xlink:href='#r_node_marker'/>
<use x='112' y='368' xlink:href='#r_node_marker'/>
<use x='112' y='448' xlink:href='#r_node_marker'/>
<text style="font-size:24px">
  <tspan x="128" y="248">R_Nodes</tspan>
</text>
</svg>

<p>
	For many of the <a href="#features">features</a> IRIS provides, a model
	of the road network topology is required.
	This model consists of a set of roadway nodes, or <b>r_node</b>s, which
	describe all the points of interest on the road network.
	For instance, each entrance or exit ramp, detector station or
	intersection would be represented by an r_node.
</p>
<p>
	All r_nodes with the same road and direction-of-travel are grouped into
	<b>corridors</b>.
	The r_nodes within a corridor are automatically sorted based on their
	coordinates.
	Corridors are linked to each other by exit and entrance r_nodes.
	For example an exit r_node from Northbound road A to Eastbound road B
	would automatically link to an entrance onto Eastbound road B from
	Northbound road A.
</p>
<h4>Road Setup</h4>
<p>
	Before creating the r_nodes, some roads must be created.
	Select the <span class="menu">View ➔ System ➔ Roads</span> menu item to
	bring up the Roads form.
	To create a new road, select the last (empty) cell in the Road column
	and type the name of the road.
	This name can be up to 20 characters in length, and uniquely identifies
	the road.
	It's a good idea to capitalize each word, and abbreviate any
	designators — for example, "Main St".
</p>
<p>
	The next column is <b>Abbrev</b>.
	Here, an abbreviation of up to 6 characters can be entered.
	This is used for labeling detectors and stations.
</p>
<p>
	The <b>Road Class</b> determines the presentation of the road on the
	map.
	For example, a road marked "Freeway" would be drawn thicker and more
	prominent than an "Expressway" or "Arterial".
</p>
<p>
	<b>Direction</b> and <b>Alt Dir</b> determine the primary and secondary
	compass directions of the road.
</p>
<h4 id="r_node">R_Node Location</h4>
<p>
	Select the <b>R_Nodes</b> tab on the client interface to create or
	edit r_nodes.
	In the <b>Selected Roadway Corridor</b> frame, there is an <b>Add</b>
	button.
	Press the button to start creating a new r_node.
	The mouse cursor will change to a <b>target</b> while over the map.
	Select the point on the map where the r_node should be located and
	left-click the mouse.
	The new r_node will appear on the map, and in the list for the
	selected corridor.
</p>
<p>
	In the <b>Selected Roadway Corridor</b> frame, there is a
	<b>Corridor</b> widget containing a list of all corridors which
	contain at least one r_node.
	When a corridor is selected, the r_node list will be populated with all
	r_nodes on the corridor.
	Also, any new r_nodes created will be on the selected corridor.
</p>
<p>
	Once an r_node is selected, any fields on the <b>Location</b> tab can
	be edited.
	Changing the roadway or direction will move the r_node to another
	corridor.
	Other attributes are nearest cross-street, cross-street direction,
	and notes.
</p>
<h4>R_Node Setup</h4>
<p>
	The r_node <b>Setup</b> tab contains several more attributes.
</p>
<dl>
  <dt id='r_node_type'>node_type</dt>
  <dd>There are six different r_node types:
    <table>
      <tr>
        <th>Code</th>
        <th>Node Type</th>
        <th>Description</th>
      </tr>
      <tr>
        <td>0</td>
        <td>station</td>
        <td>Mainline detector station or shape node</td>
      </tr>
      <tr>
	<td>1</td>
	<td>entrance</td>
	<td>Entrance ramp onto corridor</td>
      </tr>
      <tr>
	<td>2</td>
	<td>exit</td>
	<td>Exit ramp off corridor</td>
      </tr>
      <tr>
	<td>3</td>
	<td>intersection</td>
	<td>At-grade intersection with another corridor</td>
      </tr>
      <tr>
	<td>4</td>
	<td>access</td>
	<td>Network access (for traveler information)</td>
      </tr>
      <tr>
	<td>5</td>
	<td>interchange</td>
	<td>Freeway interchange (for traveler information)</td>
      </tr>
    </table>
  </dd>
  <dt id='r_node_transition'>transition</dt>
  <dd>An r_node transition describes how entrance or exit nodes connect with
      linked nodes.
    <table>
      <tr>
	<th>Code</th>
	<th>Transition</th>
	<th>Description</th>
      </tr>
      <tr>
	<td>0</td>
	<td>none</td>
	<td>No transition &mdash; non-entrance or -exit r_nodes</td>
      </tr>
      <tr>
	<td>1</td>
	<td>loop</td>
	<td>Interchange loop ramp &mdash; "leaf" part of cloverleaf</td>
      </tr>
      <tr>
	<td>2</td>
	<td>leg</td>
	<td>Typical "leg" ramp</td>
      </tr>
      <tr>
	<td>3</td>
	<td>slipramp</td>
	<td>Transition ramp between parallel corridors</td>
      </tr>
      <tr>
	<td>4</td>
	<td>CD</td>
	<td>Transition to/from collector/distributor road</td>
      </tr>
      <tr>
	<td>5</td>
	<td>HOV</td>
	<td>Bypass ramp for high-occupancy-vehicles</td>
      </tr>
      <tr>
	<td>6</td>
	<td>common</td>
	<td>Common section joining two corridors</td>
      </tr>
      <tr>
	<td>7</td>
	<td>flyover</td>
	<td>Flyover ramp (bridge over mainline)</td>
      </tr>
    </table>
  </dd>
  <dt>lanes</dt>
  <dd>Number of lanes at r_node.
      For a ramp node, this is the number of lanes entering or exiting the
      mainline.
  </dd>
  <dt>shift</dt>
  <dd>Lane shift is the difference (number of lanes) between the corridor
      reference lane and the attach side of the r_node.
      This value is used for lane continuity analysis within a corridor.
      Each corridor has a reference lane, which corresponds to the leftmost
      lane along the entire corridor.
  </dd>
  <dt>station_id</dt>
  <dd>The station_id is a unique identifier for the detectors associated with
      the r_node.
      It is displayed on the <a href="#traffic_layer">traffic layer</a>, and is
      also used for identifying travel time destinations.
  </dd>
  <dt>speed_limit</dt>
  <dd>This is the posted speed limit at the r_node.
      The units are miles per hour, but should in future be dependent on locale
      (KPH).
      For ramp r_nodes, it may be used to indicate the advisory speed limit on
      the ramp.
      The limit is used in travel time estimation.
  </dd>
  <dt>pickable</dt>
  <dd>For traveler information systems, an r_node can be marked pickable if a
      user is allowed to pick a node as an origin or destination.
      NOTE: This feature has not been implemented yet.
  </dd>
  <dt>above</dt>
  <dd>When rendering the <a href="#traffic_layer">traffic layer</a>, r_nodes are
      rendered in two passes.
      The second pass consists of r_nodes which have been marked <b>above</b>.
      This prevents overpasses from being drawn incorrectly.
  </dd>
  <dt>attach_side</dt>
  <dd>This flag indicates whether the r_node is attached to the left side of
      the road.
      This can be used to create left entrance or exit ramps.
  </dd>
  <dt>active</dt>
  <dd>This flag allows an r_node to be deactivated.  An inactive r_node will
      not be included in any corridor or drawn on the
      <a href="#traffic_layer">traffic layer</a>.
  </dd>
</dl>
<h4>R_Node Detectors</h4>
<p>
	The r_node <b>Detectors</b> tab allows vehicle
	<a href="#vds">detectors</a> to be created and associated
	with an r_node.
</p>

<h3 id="comm_links">Comm Links</h3>
<p>
	A <b>comm link</b> is a network connection to an external device or
	system.
	IRIS is capable of supporting hundreds of simultaneous comm links.
	The comm link interface is found on the <span class="menu">View ➔
	Maintenance ➔ Comm Links</span> menu item.
	Each comm link has a number of attributes, including URI and protocol.
</p>
<p>
	The URI includes a DNS host name or network IP address, and port number,
	using the standard "host:port" convention.
	The URI can also contain an optional "scheme" prefix, which can be
	either "udp://", "tcp://" or "modem://".
	If present, the scheme will override the default URI scheme for the
	selected protocol.
	For example, to use the Pelco D protocol over TCP (instead of the
	default UDP), add a "tcp://" scheme prefix to the URI.
</p>
<p>
	The protocol determines what type of device or system is on the other
	end of the comm link.
	The following table contains the communication protocols supported by
	IRIS.
</p>
<table>
	<tr>
	    <th>Protocol</th>
	    <th>Description</th>
	    <th>Default Scheme</th>
	</tr>
	<tr>
	    <td>NTCIP Class A</td>
	    <td><a href="#dms">DMS</a> control,
	        <a href="#ilcs">ILCS</a> (no HDLC)
	    </td>
	    <td>UDP</td>
	</tr>
	<tr>
	    <td>NTCIP Class B</td>
	    <td><a href="#dms">DMS</a> control,
	        <a href="#ilcs">ILCS</a> over serial (HDLC)</td>
	    <td>TCP</td>
	</tr>
	<tr>
	    <td>NTCIP Class C</td>
	    <td><a href="#dms">DMS</a> control,
	        <a href="#ilcs">ILCS</a> (no HDLC)</td>
	    <td>TCP</td>
	</tr>
	<tr>
	    <td>DMS XML</td>
	    <td><a href="#dms">DMS</a> control to external system</td>
	    <td>TCP</td>
	</tr>
	<tr>
	    <td>Msg feed</td>
	    <td><a href="#msg_feed">DMS messages</a> from external system</td>
	    <td>TCP / HTTP</td>
	</tr>
	<tr>
	    <td>MnDOT 170 4</td>
	    <td><a href="#vds">VDS</a>,
	        <a href="#ramp_meters">metering</a>,
	        <a href="#dlcs">DLCS</a>,
		<a href="#beacons">beacons</a>,
		<a href="#alarms">alarms</a>
	    </td>
	    <td>TCP</td>
	</tr>
	<tr>
	    <td>MnDOT 170 5</td>
	    <td><a href="#vds">VDS</a>,
	        <a href="#ramp_meters">metering</a>,
	        <a href="#dlcs">DLCS</a>,
		<a href="#beacons">beacons</a>,
		<a href="#alarms">alarms</a>
	    </td>
	    <td>TCP</td>
	</tr>
	<tr>
	    <td>Canoga</td>
	    <td><a href="#vds">VDS</a> (GTT Canoga Traffic Sensing System)</td>
	    <td>TCP</td>
	</tr>
	<tr>
	    <td>SS105</td>
	    <td><a href="#vds">VDS</a> (original Wavetronix SmartSensor)</td>
	    <td>TCP</td>
	</tr>
	<tr>
	    <td>SS125</td>
	    <td><a href="#vds">VDS</a> (Wavetronix SmartSensor HD)</td>
	    <td>TCP</td>
	</tr>
	<tr>
	    <td>RTMS G4</td>
	    <td><a href="#vds">VDS</a> (RTMS G4 sensor)</td>
	    <td>TCP</td>
	</tr>
	<tr>
	    <td>Pelco D</td>
	    <td><a href="#ptz">PTZ</a> for Pelco cameras</td>
	    <td>UDP</td>
	</tr>
	<tr>
	    <td>Manchester</td>
	    <td><a href="#ptz">PTZ</a> for AD cameras</td>
	    <td>UDP</td>
	</tr>
	<tr>
	    <td>Vicon</td>
	    <td><a href="#ptz">PTZ</a> for Vicon cameras</td>
	    <td>UDP</td>
	</tr>
	<tr>
	    <td>Infinova</td>
	    <td><a href="#ptz">PTZ</a> for Infinova cameras</td>
	    <td>TCP</td>
	</tr>
	<tr>
	    <td>Cohu</td>
	    <td><a href="#ptz">PTZ</a> for Cohu cameras</td>
	    <td>TCP</td>
	</tr>
	<tr>
	    <td>STC</td>
	    <td><a href="#gate_arms">Gate Arm</a> control for HySecurity
	        SmartTouch Controllers
	    </td>
	    <td>TCP</td>
	</tr>
	<tr>
	    <td>Pelco Switcher</td>
	    <td><a href="#video">Video switching</a> for Pelco</td>
	    <td>TCP</td>
	</tr>
	<tr>
	    <td>Org 815</td>
	    <td><a href="#rwis">RWIS</a> (ORG 815 sensor)</td>
	    <td>TCP</td>
	</tr>
	<tr>
	    <td>SSI</td>
	    <td><a href="#rwis">RWIS</a> (SSI RWIS sensor)</td>
	    <td>TCP / HTTP</td>
	</tr>
	<tr>
	    <td><a href="#din_relay">DLI DIN Relay</a></td>
	    <td><a href="#dlcs">DLCS</a>, <a href="#beacons">beacons</a></td>
	    <td>TCP / HTTP</td>
	</tr>
</table>
<p/>

<h4 id="msg_feed">DMS Msg Feed Protocol</h4>
<p>
	The "msg feed" protocol can be used to interface IRIS with an external
	system that generates <a href="#dms">DMS</a> messages.
	Periodically, IRIS will poll the URI (using HTTP) for DMS messages.
	The external system should respond with an ASCII text file, with one
	line per message to be deployed.
</p>
<p>
	Each line must contain 3 fields, separated by tab characters "\t"
	(ASCII 0x09), and terminated with a single newline character "\n"
	(ASCII 0x0A).
	The fields are DMS name, <a href="#multi">MULTI</a> string, and
	expiration time.
	The DMS name must exactly match one of the DMS as identified by IRIS.
	The MULTI string specifies a message to display on the sign, using the
	MULTI markup language, from NTCIP 1203.
	For example, "ROAD CLOSED[nl]AHEAD[nl]LEFT LANE CLOSED" is a valid
	three-line MULTI message.
	The expiration field indicates the date and time that the message
	should expire.
	It is in "yyyy-MM-dd HH:mm:ssZ" format, which includes date, time and
	time zone.
	A valid expiration time would be 2012-05-15 11:37:00-0600.
</p>
<p>
	There are a couple of other required steps to enable a message feed
	to operate.
	First, an action plan must be created which associates a DMS action
	with the message feed.
	The DMS action must be associated with a quick message that references
	the message feed, using a special MULTI tag.
	So, if the message feed is on a Comm Link called "LFEED", then the
	quick message MULTI string must be "[feedLFEED]".
	Also, the action plan must be active and deployed.
	This requirement allows only administrator-approved DMS to be controlled
	by the message feed.
</p>
<p>
	The other requirement for message feeds is that all messages used by
	the feed must be defined in the DMS message library.
	This requirement allows only administrator-approved messages to be
	deployed by the message feed.
	In some circumstances, it may be appropriate to disable this checking.
	For example, if the message feed host is fully trusted and there is no
	possibility of man-in-the-middle attacks between IRIS and the feed host.
	In this case the "msg_feed_verify" <a href="#system_attributes">system
	attribute</a> can be set to "false" to disable this check.
</p>

<h4 id="din_relay">DIN Relay</h4>
<p>
	DIN relay is is product by DLI which allows simple devices to be turned
	on of off through an HTTP (web) interface.
	Each device can control up to 8 outlets, which for a
	<a href="#dlcs">DLCS</A> means 2 lanes with 3 indications each.
</p>

<h3 id="controllers">Controllers</h3>
<p>
	After a comm link has been created, a <b>controller</b> must be
	associated with it.
	Some protocols support <b>multi-drop</b> addressing, and others are
	<b>single-drop</b> only.
	Multi-drop addressing allows multiple controllers to share the same
	comm link.
	Each controller is assigned a unique (to the comm link) drop address,
	which is used to route all messages sent to the controller.
	Controllers can be assigned to a <b>cabinet</b>, which has location
	information, to allow displaying on a map.
</p>

<h4 id="io_pins">I/O Pins</h4>
<p>
	Each controller has a set of <b>I/O pins</b>, to which
	<a href="#devices">devices</a> can be assigned.
	The function of these pins is protocol specific &mdash; see the
	following table.
</p>
<table>
	<tr>
	    <th>Device Type</th>
	    <th>Protocol</th>
	    <th>I/O Pin(s)</th>
	</tr>
	<tr>
	    <td><a href="#dms">DMS</a>, <a href="#ilcs">ILCS</a></td>
	    <td>NTCIP (A, B, C), DMS XML</td>
	    <td>1</td>
	</tr>
	<tr>
	    <td rowspan="2"><a href="#dlcs">DLCS</a></td>
	    <td>MnDOT 170 (4, 5)</td>
	    <td>19 - 36</td>
	</tr>
	<tr>
	    <td><a href="#din_relay">DIN Relay</a></td>
	    <td>1 - 8</td>
	</tr>
	<tr>
	    <td><a href="#cameras">Camera</a></td>
	    <td>Pelco D, Manchester, Vicon, Infinova, Cohu</td>
	    <td>1</td>
	</tr>
	<tr>
	    <td rowspan="4"><a href="#vds">VDS</a></td>
	    <td>MnDOT 170 (4, 5)</td>
	    <td>39 - 62</td>
	</tr>
	<tr>
	    <td>Canoga</td>
	    <td>1 - 4</td>
	</tr>
	<tr>
	    <td>SS105, SS125</td>
	    <td>1 - 8</td>
	</tr>
	<tr>
	    <td>RTMS G4</td>
	    <td>1 - 12</td>
	</tr>
	<tr>
	    <td><a href="#ramp_meters">Ramp Meter</a></td>
	    <td>MnDOT 170 (4, 5)</td>
	    <td>2 or 3</td>
	</tr>
	<tr>
	    <td><a href="#gate_arms">Gate Arm</a></td>
	    <td>STC</td>
	    <td>1</td>
	</tr>
	<tr>
	    <td rowspan="2"><a href="#beacons">Beacon</a></td>
	    <td>MnDOT 170 (4, 5)</td>
	    <td>2</td>
	</tr>
	<tr>
	    <td><a href="#din_relay">DIN Relay</a></td>
	    <td>1 - 8</td>
	</tr>
	<tr>
	    <td><a href="#rwis">RWIS</a></td>
	    <td>Org 815, SSI</td>
	    <td>1</td>
	</tr>
	<tr>
	    <td><a href="#video">Video Switcher</a></td>
	    <td>Pelco</td>
	    <td>1</td>
	</tr>
</table>
<br/>

<h3 id="fonts">Fonts</h3>
<p>
	A font is a set of bitmapped glyphs for displaying text on a dynamic
	message sign (DMS).
	Each font can contain any of the printable characters in the ASCII
	character set (0x20 to 0x7E).
</p>
<p>
	When selecting a font, a few parameters must be considered, such as
	pixel pitch, desired character height, and font weight.
	Pixel pitch can vary from 66 mm down to 20 mm or smaller.
	Typically, for freeway signs, characters should be between 350 and 400
	mm (about 14 or 15 inches) high.
	See the table below for character heights based on these common sizes.
</p>
<table>
	<tr>
	    <th rowspan='2'>Font Height</th>
	    <th colspan='4'>Pixel Pitch</th>
	</tr>
	<tr>
	    <th>20 mm</th>
	    <th>33 mm</th>
	    <th>50 mm</th>
	    <th>66 mm</th>
	</tr>
	<tr>
	    <th>7 px</th>
	    <td>120 mm</td>
	    <td>198 mm</td>
	    <td>300 mm</td>
	    <td class='best'>396 mm</td>
	</tr>
	<tr>
	    <th>8 px</th>
	    <td>140 mm</td>
	    <td>231 mm</td>
	    <td class='best'>350 mm</td>
	    <td>462 mm</td>
	</tr>
	<tr>
	    <th>10 px</th>
	    <td>180 mm</td>
	    <td>297 mm</td>
	    <td>450 mm</td>
	    <td>594 mm</td>
	</tr>
	<tr>
	    <th>12 px</th>
	    <td>220 mm</td>
	    <td class='best'>363 mm</td>
	    <td>550 mm</td>
	    <td>726 mm</td>
	</tr>
	<tr>
	    <th>14 px</th>
	    <td>260 mm</td>
	    <td>429 mm</td>
	    <td>650 mm</td>
	    <td>858 mm</td>
	</tr>
	<tr>
	    <th>16 px</th>
	    <td>300 mm</td>
	    <td>495 mm</td>
	    <td>750 mm</td>
	    <td>990 mm</td>
	</tr>
	<tr>
	    <th>18 px</th>
	    <td>340 mm</td>
	    <td>561 mm</td>
	    <td>850 mm</td>
	    <td>1122 mm</td>
	</tr>
	<tr>
	    <th>20 px</th>
	    <td class='best'>380 mm</td>
	    <td>627 mm</td>
	    <td>950 mm</td>
	    <td>1254 mm</td>
	</tr>
</table>
<p>
	In the past, DMS have been used with upper-case only fonts, but with
	smaller pixel pitch, it is possible to create legible fonts which
	also include lower-case characters.
	If a message containing lower-case characters is used with an upper-case
	only font, IRIS will replace those characters with their equivalent.
</p>
<p>
	Fifteen fonts are included in the IRIS template SQL script.
	These fonts are designed to have a similar visual style.
</p>
<table>
	<tr>
	    <th>Number</th>
	    <th>Font Name</th>
            <th>Description</th>
	</tr>
	<tr>
	    <td>1</td>
	    <td>07_char</td>
	    <td>7x5 character matrix</td>
	</tr>
	<tr>
	    <td>2</td>
	    <td>07_line</td>
	    <td>7 pixel high line-matrix</td>
	</tr>
	<tr>
	    <td>3</td>
	    <td>08_full</td>
	    <td>8 pixel high full-matrix</td>
	</tr>
	<tr>
	    <td>4</td>
	    <td>09_full</td>
	    <td>9 pixel high full-matrix</td>
	</tr>
	<tr>
	    <td>5</td>
	    <td>10_full</td>
	    <td>10 pixel high full-matrix</td>
	</tr>
	<tr>
	    <td>6</td>
	    <td>11_full</td>
	    <td>11 pixel high full-matrix</td>
	</tr>
	<tr>
	    <td>7</td>
	    <td>12_full</td>
	    <td>12 pixel high full-matrix</td>
	</tr>
	<tr>
	    <td>8</td>
	    <td>12_full_bold</td>
	    <td>12 pixel high full-matrix bold</td>
	</tr>
	<tr>
	    <td>9</td>
	    <td>13_full</td>
	    <td>13 pixel high full-matrix</td>
	</tr>
	<tr>
	    <td>11</td>
	    <td>14_full</td>
	    <td>14 pixel high full-matrix</td>
	</tr>
	<tr>
	    <td>13</td>
	    <td>16_full</td>
	    <td>16 pixel high full-matrix</td>
	</tr>
	<tr>
	    <td>14</td>
	    <td>18_full</td>
	    <td>18 pixel high full-matrix</td>
	</tr>
	<tr>
	    <td>15</td>
	    <td>20_full</td>
	    <td>20 pixel high full-matrix (numerals only)</td>
	</tr>
	<tr>
	    <td>16</td>
	    <td>24_full</td>
	    <td>24 pixel high full-matrix (numerals only)</td>
	</tr>
	<tr>
	    <td>17</td>
	    <td>_09_full_12</td>
	    <td>9 pixel high (12 with lower case descenders)</td>
	</tr>
</table>
<p>
	The IRIS client also contains a font editor which can be used to design
	new DMS fonts.
	The font interface is found on the <span class="menu">View ➔
	Message Signs ➔ DMS Fonts</span> menu item.
</p>

<h2 id="devices">Devices</h2>
<p>
	A device is a hardware field control or sensing system.
	IRIS supports several different device types:
	<a href="#dms">dynamic message signs</a>,
	<a href="#cameras">cameras</a>,
	<a href="#vds">vehicle detection</a>,
	<a href="#lcs">lane-use control signs</a>,
	<a href="#ramp_meters">ramp meters</a>,
	<a href="#gate_arms">gate arms</a>,
	<a href="#beacons">beacons</a>,
	<a href="#alarms">alarms</a>,
	<a href="#rwis">road weather information systems</a>, and
	<a href="#lane_marking">lane marking</a>.
</p>
<p>
	For any device to be activated, it must first be connected to one of the
	<a href="#io_pins">I/O pins</a> on a
	<a href="#controllers">controller</a>.
	The controller must also be associated with a
	<a href="#comm_links">comm link</a> which communicates using the
	appropriate protocol for the device.
</p>

<h3 id="dms">Dynamic Message Signs (DMS)</h3>
<p>
	A dynamic message sign (DMS) is a sign which is capable of changing the
	message displayed to motorists.
	They can be classified as character-matrix, line-matrix and full-matrix,
	depending on the spacing between pixels.
	Some are monochrome, and some support full color display.
	All of these configurations are supported by IRIS.
</p>
<p>
	The following operations can be performed on a DMS:
</p>
<ul>
	<li>Querying currently displayed message</li>
	<li>Displaying new messages</li>
	<li>Querying configuration information</li>
	<li>Querying diagnostic information</li>
	<li>Sending fonts and graphics</li>
</ul>

<h4>DMS Setup</h4>
FIXME

<h4 id="multi">MULTI (Markup Language for Transportation Information)</h4>
<p>
	DMS messages are specified using <b>MULTI</b>, as defined by the
	NTCIP 1203 standard.
	In MULTI, messages are simple ASCII strings, with formatting or other
	instructions denoted by tags inside square brackets.
	For example, the tag <code>[nl]</code> indicates a new line.
	Most of the useful standard MULTI tags are supported, as well as a few
	which are specific to IRIS.
	The following table summarizes the tags supported by IRIS.
</p>
<table>
	<tr>
	    <th>Tag</th>
	    <th>Description</th>
	    <th>Supported</th>
	</tr>
	<tr>
	    <td>[cb<i>x</i>]</td>
	    <td>Message background color</td>
	    <td>Yes</td>
	</tr>
	<tr>
	    <td>[pb<i>z</i>]</td>
	    <td rowspan="2">Page background color</td>
	    <td rowspan="2">Yes</td>
	</tr>
	<tr>
	    <td>[pb<i>r</i>,<i>g</i>,<i>b</i>]</td>
	</tr>
	<tr>
	    <td>[cf<i>x</i>]</td>
	    <td rowspan="2">Foreground color</td>
	    <td rowspan="2">Yes</td>
	</tr>
	<tr>
	    <td>[cf<i>r</i>,<i>g</i>,<i>b</i>]</td>
	</tr>
	<tr>
	    <td>[cr<i>x</i>,<i>y</i>,<i>w</i>,<i>h</i>,<i>z</i>]</td>
	    <td rowspan="2">Color rectangle</td>
	    <td rowspan="2">Yes</td>
	</tr>
	<tr>
	    <td>[cr<i>x</i>,<i>y</i>,<i>w</i>,<i>h</i>,<i>r</i>,<i>g</i>,<i>b</i>]</td>
	</tr>
	<tr>
	    <td>[f<i>x</i>,<i>y</i>]</td>
	    <td>Field data</td>
	    <td>No</td>
	</tr>
	<tr>
	    <td>[flt<i>x</i>o<i>y</i>]</td>
	    <td rowspan="2">Flashing text</td>
	    <td rowspan="2">No</td>
	</tr>
	<tr>
	    <td>[flo<i>y</i>t<i>x</i>]</td>
	</tr>
	<tr>
	    <td>[fo<i>x</i>]</td>
	    <td rowspan="2">Change font</td>
	    <td rowspan="2">Yes</td>
	</tr>
	<tr>
	    <td>[fo<i>x</i>,<i>cccc</i>]</td>
	</tr>
	<tr>
	    <td>[g<i>n</i>]</td>
	    <td rowspan="3">Place graphic</td>
	    <td rowspan="3">Yes</td>
	</tr>
	<tr>
	    <td>[g<i>n</i>,<i>x</i>,<i>y</i>]</td>
	</tr>
	<tr>
	    <td>[g<i>n</i>,<i>x</i>,<i>y</i>,<i>cccc</i>]</td>
	</tr>
	<tr>
	    <td>[hc<i>n</i>]</td>
	    <td>Hexadecimal character</td>
	    <td>No</td>
	</tr>
	<tr>
	    <td>[jl<i>n</i>]</td>
	    <td>Line justification</td>
	    <td>Yes</td>
	</tr>
	<tr>
	    <td>[jp<i>n</i>]</td>
	    <td>Page justification</td>
	    <td>Yes</td>
	</tr>
	<tr>
	    <td>[ms<i>x</i>,<i>y</i>]</td>
	    <td>Manufacturer specific</td>
	    <td>No</td>
	</tr>
	<tr>
	    <td>[mv<i>...</i>]</td>
	    <td>Moving text</td>
	    <td>No</td>
	</tr>
	<tr>
	    <td>[nl]</td>
	    <td rowspan="2">New line</td>
	    <td rowspan="2">Yes</td>
	</tr>
	<tr>
	    <td>[nl<i>s</i>]</td>
	</tr>
	<tr>
	    <td>[np]</td>
	    <td>New page</td>
	    <td>Yes</td>
	</tr>
	<tr>
	    <td>[pt<i>n</i>]</td>
	    <td rowspan="2">Page time</td>
	    <td rowspan="2">Yes</td>
	</tr>
	<tr>
	    <td>[pt<i>n</i>o<i>f</i>]</td>
	</tr>
	<tr>
	    <td>[sc<i>x</i>]</td>
	    <td>Character spacing</td>
	    <td>Yes</td>
	</tr>
	<tr>
	    <td>[tr<i>x</i>,<i>y</i>,<i>w</i>,<i>h</i>]</td>
	    <td>Text rectangle</td>
	    <td>Yes</td>
	</tr>
	<tr>
	    <td>[tt<i>n</i>]</td>
	    <td>Travel time</td>
	    <td>IRIS-only</td>
	</tr>
	<tr>
	    <td>[vsa]</td>
	    <td>Speed advisory</td>
	    <td>IRIS-only</td>
	</tr>
	<tr>
	    <td>[slow<i>s</i>,<i>b</i>,<i>u</i>,<i>dist</i>]</td>
	    <td>Slow traffic warning</td>
	    <td>IRIS-only</td>
	</tr>
	<tr>
	    <td>[feed<i>n</i>]</td>
	    <td><a href="#msg_feed">Message feed</a></td>
	    <td>IRIS-only</td>
	</tr>
</table>
<br/>

<h3 id="cameras">Cameras</h3>
<p>
	Closed-circuit television cameras are commonly used to monitor traffic
	conditions.
	These cameras can transmit video to a traffic management center using
	either an analog signal (with dedicated cabling) or a digital stream
	(using an IP network).
	There are advantages to both approaches.
	Analog video has high picture quality and very low latency, while
	digital video is much cheaper and easier to route around.
</p>
<p>
	To display camera video in IRIS, it must be digitally encoded.
</p>
<h4 id="ptz">Pan / Tilt / Zoom</h4>
<p>
	Some cameras have a built-in pan/tilt/zoom (PTZ) functionality.
	IRIS can perform the following PTZ operations:
</p>
<ul>
	<li>Panning / tilting the camera</li>
	<li>Zooming in or out</li>
	<li>Recall preset positions</li>
	<li>Store preset positions</li>
</ul>
<h4 id="video">Video Switching</h4>
<p>
	IRIS can also be configured to send commands to a video switcher
	system.
	This allows camera video (or streams) to be routed to a number of video
	monitors.
	Each monitor can be assigned to display the video from any specific
	camera.
	IRIS allows an operator to select one video monitor to be linked with
	their camera selection on the user interface.
	This way, every time the user selects a camera, it's video is
	immediately displayed on the associated monitor.
</p>

<h3 id="vds">Vehicle Detection Systems</h3>
<p>
	There are several types of <b>vehicle detection systems</b> (VDS)
	&mdash; also called <b>traffic sensing systems</b>.
	The oldest of these is the inductive loop detector, which is a
	wire placed under the surface of the road.
	It is able to magnetically detect the metal in vehicles as they pass
	over.
	Another type of sensor uses radar mounted on the side of the road.
	This type is <b>non-intrusive</b>, since the road surface does not need
	to be cut to install the detector.
	A third type &ndash; also non-intrusive &ndash; is video detection.
	These systems use video cameras and computer vision software to
	detect vehicles.
</p>
<h4>VDS Configuration</h4>
<p>
	To create a detector, first select the <a href="#r_node">r_node</a>
	at the location of the detector.
	Then, select the <b>Detectors</b> tab for the r_node.
	Type the detector name in the text entry widget just above the
	<b>Create</b> button, and press that button.
	After selecting the new detector in the r_node detector table,
	its properties, such as <b>lane type</b> and <b>lane #</b> can be
	changed.
	In IRIS, lanes are numbered from right-to-left, starting with the
	right lane as 1.
</p>

<h4>VDS Protocols</h4>
<p>
	IRIS supports several different protocols for communicating with
	vehicle detection systems.
	For most VDS protocols, traffic data is binned at a fixed time interval.
	Some protocols allow the binning interval to be adjusted.
	IRIS collects traffic data including <b>volume</b> (traffic counts),
	<b>occupancy</b>, <b>speed</b>, and <b>vehicle classification</b>.
	Some protocols do not use binning at all &mdash; instead they record
	timestamps and headway for each vehicle passing by the sensor.
	The following table summarizes features of each protocol.
</p>
<table>
	<tr>
	    <th>Protocol</th>
	    <th>Addressing</th>
	    <th>Binning</th>
	    <th>Speed</th>
	</tr>
	<tr>
	    <th>MnDOT 170 4</th>
	    <td>4-bit (1-15)</td>
	    <td>30 seconds (+5 minute)</td>
	    <td>No</td>
	</tr>
	<tr>
	    <th>MnDOT 170 5</th>
	    <td>5-bit (1-31)</td>
	    <td>30 seconds (+5 minute)</td>
	    <td>No</td>
	</tr>
	<tr>
	    <th>Canoga</th>
	    <td>8-bit (1-255)</td>
	    <td>No (vehicle logging)</td>
	    <td>Double loops only</td>
	</tr>
	<tr>
	    <th>SS105</th>
	    <td>4-digit (0001-9999)</td>
	    <td>5 seconds to 1 month</td>
	    <td>Yes</td>
	</tr>
	<tr>
	    <th>SS125</th>
	    <td>32-bit (0-65535)</td>
	    <td>???</td>
	    <td>Yes</td>
	</tr>
	<tr>
	    <th>RTMS G4</th>
	    <td>32-bit (0-65535)</td>
	    <td>10 seconds to 1 hour</td>
	    <td>Yes</td>
	</tr>
</table>
<br/>
<h4 id="vds_archiving">VDS Data Archiving</h4>
<p>
	Every 30 seconds, an XML file is generated containing the most recent
	sample data from all defined detectors.
	The file is called det_sample.xml.gz, and it is written to the
	<a href="#xml_output">XML output directory</a>
</p>
<p>
	Sample data is archived only if the <code>sample_archive_enable</code>
	<a href="#system_attributes">system attribute</a> is set to
	<code>true</code>.
	Sample archive files are stored in <code>/var/lib/iris/traffic</code>,
	in a directory with the district ID name.
</p>

<h3 id="lcs">Lane-use Control Signs (LCS)</h3>
<p>
	A lane-use control sign (LCS) is a sign which is mounted over a single
	lane of traffic (typically one for each lane).
	It can display a set of indications which either permit or restrict
	use of that lane.
</p>

<h4 id="ilcs">"Intelligent" Lane-use Control Signs (ILCS)</h4>
<p>
	An "intelligent" LCS is a full-matrix color <a href="#dms">DMS</a> which
	is mounted directly over a lane of traffic.
	In addition to being used as an LCS, it can display
	<a href="#vsa">variable speed advisories</a>, or any operator-defined
	message as a regular DMS.
</p>

<h4 id="dlcs">"Dumb" Lane-use Control Signs (DLCS)</h4>
<p>
	A "dumb" LCS device is much simpler than an ILCS.
	It can display one of a fixed set of indications &mdash; typically a
	<i>green arrow</i> <span class="green">&nbsp;↓&nbsp;</span>, a
	<i>yellow arrow</i> <span class="yellow">&nbsp;↓&nbsp;</span> or a
	<i>red X</i> <span class="red">&nbsp;X&nbsp;</span>).
	Each indication must be assigned to a separate
	<a href="#io_pins">I/O pin</a> on a
	<a href="#controllers">controller</a>, as well as the DMS which
	represents the LCS.
</p>

<h3 id="ramp_meters">Ramp Meters</h3>
<p>
	A ramp meter is a traffic signal at an on-ramp which controls the rate
	of vehicles entering a freeway.
	Typically, one vehicle is permitted to enter for each green indication
	displayed on the signal.
</p>
<p>
	The following operations can be performed on a ramp meter:
</p>
<ul>
	<li>Activating and deactivating meter</li>
	<li>Adjusting meter release rate</li>
	<li>Querying meter status</li>
	<li>Querying green counts</li>
	<li>Synchronizing clock</li>
	<li>Configuring time-of-day operation</li>
</ul>

<h3 id="gate_arms">Gate Arms</h3>
<p>
	Gate Arms are traffic control devices which restrict access to a
	section of roadway.
	They can be used, for example, for reversible lanes which can be changed
	by time of day.
</p>

<h3 id="beacons">Beacons</h3>
<p>
	A beacon is a light or set of lights that flashes toward oncoming
	traffic.
	Its purpose is to draw attention to a <a href="#dms">DMS</a> or static
	sign.
	Sometimes, they are called <b>flashers</b> or <b>wig-wags</b>.
</p>

<h3 id="alarms">Alarms</h3>
<p>
	An alarm is a simple device which is triggered when an event happens.
	The event could be an equipment failure, high temperature, etc.
	Alarms can be monitored to help maintain field devices.
</p>

<h3 id="rwis">Road Weather Information Systems</h3>
<p>
	Road Weather Information Systems (RWIS) can sense data such as
	precipitation rate, road surface temperature, wind speed, etc.
</p>

<h3 id="lane_marking">Lane Marking</h3>
<p>
	A lane marking device is also called <b>in-road lighting</b>.  It allows
	the lane striping to be changed dynamically, by turning on and off
	lights embedded in the road.
</p>

<h2 id="features">Features</h2>

<h3 id="traffic_layer">Traffic Map Layer</h3>
<p>
	The IRIS client user interface includes a traffic map layer which is
	created automatically from the <a href="#road_topology">road
	topology</a>.
	By default, this "segment" layer uses traffic <b>density</b> to
	determine the color of each segment in the layer.
	Other themes are available for <b>speed</b> and <b>flow</b>.
	The <b>Legend</b> menu at the top of the map can be used to view
	the thresholds used for each color in a theme.
</p>
<p>
	Every 30 seconds, the client will make an HTTP request for the current
	traffic sample data XML file.
	The URL to locate that file is declared as a property in the
	/etc/iris/iris-client.properties file (on the IRIS server).
	The property is tdxml.detector.url, and it should point to the location
	of <a href="#vds_archiving">det_sample.xml.gz</a>, as made
	available by apache on the IRIS server.
</p>
<p>
	The appearance of the traffic map layer changes depending on the current
	map zoom level.
	If the zoom level is below 10, the layer will not be visible.
	At zoom levels 10 through 13, the layer will display segments as
	aggregate of all detectors in each mainline station.
	At zoom level 14 or above, each mainline detector will be displayed
	as a separate segment.
</p>

<h3 id="incident_management">Incident Management</h3>
FIXME

<h3 id="action_plans">Action Plans</h3>
FIXME

<h3 id="schedules">Date/Time Schedules</h3>
FIXME

<h3 id="metering_strategies">Ramp Metering Strategies</h3>
FIXME

<h3 id="travel_time">Travel Time Estimation</h3>
FIXME

<h3 id="vsa">Variable Speed Advisory</h3>
FIXME

<h2 id="troubleshooting">Troubleshooting</h2>

<h3 id="error_logs">Error Logs</h3>
FIXME

<h3 id="xml_output">XML Output</h3>
<p>
	There are a number of XML files which are written by the IRIS server
	periodically.
	These files contain configuration information about the system as
	well as realtime data concerning the current state.
	These files are stored in the /var/www/html/iris_xml/ directory.
</p>
<table>
	<tr>
	    <th>Filename</th>
	    <th>Description</th>
	    <th>Period</th>
	</tr>
	<tr>
	    <td>tms_config.xml.gz</td>
	    <td>Configuration data for IRIS system.  If the
		<a href="#district">district</a> server property is changed, the
		filename will be changed to match {district}_config.xml.gz.</td>
	    <td>24 hours</td>
	</tr>
	<tr>
	    <td>det_sample.xml.gz</td>
	    <td>Sample data from <a href="#vds">vehicle detection systems</a>
	    </td>
	    <td>30&nbsp;seconds</td>
	</tr>
	<tr>
	    <td>stat_sample.xml.gz</td>
	    <td>Mainline station data from <a href="#vds">vehicle detection
	        systems</a>
	    </td>
	    <td>30 seconds</td>
	</tr>
	<tr>
	    <td>incident.xml.gz</td>
	    <td>Current incident information</td>
	    <td>30 seconds</td>
	</tr>
	<tr>
	    <td>sign_message.xml.gz</td>
	    <td>Current DMS sign message information</td>
	    <td>30 seconds</td>
	</tr>
</table>
<p/>

<h3 id="event_tables">Database Event Tables</h3>
FIXME

<h3 id="debug_logs">Debug Trace Logs</h3>
FIXME

<h2 id="maintenance">Maintenance</h2>
<p>
	Once an IRIS system is set up, there are a few maintenance tasks which
	need to be done to ensure reliable operation.
</p>
<h3 id="database_backups">Database Backup &amp; Restore</h3>
<p>
	It is a good idea to backup the IRIS database on a regular basis.
	This can be done simply with a command such as the following:
</p>
<pre class="code">pg_dump tms | gzip &gt; tms-20120523.sql.gz</pre>
<p>
	This command can be placed in a simple python or bash script which is
	run by cron once per day.
	For off-site backups, the file could be copied to another host, using
	scp or a similar utility.
</p>
<p>
	To restore the tms database from one of these backup files, you will
	first need to shut down the IRIS server (and anything else connected
	to the tms database).
	Then, run the following commands (as tms user):
</p>
<pre class="code">dropdb tms
createdb tms
zcat tms-20120523.sql.gz | pgsql tms</pre>

<h3 id="iris_upgrades">IRIS Upgrades</h3>
<p>
	Upgrading an IRIS system to a new version is a simple process.
	There are two different scenarios to deal with when upgrading:
	<b>stable</b> versus <b>unstable</b>.
	Either way, it's advisable to <a href="#database_backups">backup the
	database</a> before attempting an upgrade.
</p>
<p>
	A stable upgrade is when the major and minor IRIS version numbers do not
	change &mdash; just the <b>micro</b> version.
	So, upgrading from 3.145.0 to 3.145.1 would be a stable updgrade.
	This type of upgrade never involves a database schema change.
	With the new rpm file available, a stable upgrade can be accomplished
	with the following commands (as root):
</p>
<pre class="code">yum update iris-<i>{major}</i>.<i>{minor}</i>.<i>{micro}</i>-<i>{build}</i>.noarch.rpm
iris_ctl update
systemctl restart iris.service</pre>
<p>
	An unstable upgrade is when either the major or minor IRIS version
	numbers change.
	Upgrading from 3.144.0 to 3.145.0 would be an unstable upgrade.
	This type of upgrade always involves a database schema change.
	To upgrade the database schema, an SQL migrate script must be run for
	each intervening version.
	The following commands can be used to perform an unstable upgrade
	(as root):
</p>
<pre class="code">yum update iris-<i>{major}</i>.<i>{minor}</i>.<i>{micro}</i>-<i>{build}</i>.noarch.rpm
psql tms -f /var/lib/iris/sql/migrate-<i>{major}</i>.<i>{minor}</i>.sql
iris_ctl update
systemctl restart iris.service</pre>
<p>
	Note: when skipping one or more minor versions in an upgrade, <b>all</b>
	migrate scripts must be run.
	So, when upgrading from 3.143.0 to 3.145.0, the database upgrade would
	consist of these commands:
</p>
<pre class="code">psql tms -f /var/lib/iris/sql/migrate-3.144.sql
psql tms -f /var/lib/iris/sql/migrate-3.145.sql</pre>
<p>
	Warning: there is no supported method of <b>downgrading</b> an IRIS
	system.
	If a downgrade is required, the database should be restored from a
	backup and the IRIS rpm should be reinstalled.
</p>

<h3 id="system_updates">System Software Updates</h3>
FIXME

<h3 id="monitoring_logs">Monitoring Logs</h3>
FIXME

<h2 id="development">Development</h2>

<h3 id="building">Building</h3>
<p>
	Install <a href="http://fedoraproject.org">Fedora</a> onto the
	development system.
	Some additional development packages must be installed.
</p>
<pre class="code">yum install java-1.7.0-openjdk-devel ant-junit mercurial rpm-build gcc</pre>
<p>
	In a suitable development directory, clone the iris mercurial
	repository.
</p>
<pre class="code">hg clone http://iris.dot.state.mn.us/hg/index.cgi/iris</pre>
<p>
	Create lib/ directory in iris development repository.
</p>
<pre class="code">mkdir iris/lib/</pre>
<p>
	Download the <a href="http://www.oracle.com/technetwork/java/index-138643.html">JavaMail API</a> from Oracle.
	Unzip the JavaMail archive and locate the mail.jar file.
	Copy the mail.jar file to the lib/ directory in the iris repository.
</p>
<p>
	Copy <code>iris-build.properties</code> from etc/ to lib/.
	Edit <code>lib/iris-build.properties</code> file as necessary for your
	organization.
</p>
<p>
	Create the key for signing jar packages.
	This is required for Java Web Start, which is used by the IRIS client.
	The key should go into your default keystore (~/.keystore).
</p>
<pre class="code">keytool -genkeypair -alias signing-key</pre>
<p>
	Put the following lines into your ~/.ant.properties file.
</p>
<pre class="code">debug=off
sign.store=${user.home}/.keystore
sign.store.pass=password
sign.alias=signing-key
sign.alias.pass=signing-password
hgbase.url=http://iris.dot.state.mn.us/hg/index.cgi/
</pre>
<p>
	Now, the IRIS rpm file can be built with the following commands.
	(The current directory should be the root of the iris repository.
</p>
<pre class="code">ant rpm</pre>
<p>
	If there are no errors, the new rpm file should be in the
	<code>build/rpm/RPMS/noarch/</code> directory.
</p>

<h3 id="history">History</h3>
<dl>
	<dt>March 1999</dt>
	<dd>Started work on NTCIP DMS control</dd>
	<dt>May 2007</dt>
	<dd>First GPL open source release</dd>
	<dt>May 2008</dt>
	<dd>IRIS live in Caltrans D10</dd>
	<dt>April 2011</dt>
	<dd>Officially adopted by Caltrans</dd>
</dl>

<h3 id="future_plans">Future Plans</h3>
FIXME

<h3 id="contributing">Contributing</h3>
FIXME

<h3 id="coding_style">Coding Style</h3>
<p>
	The coding style for IRIS is focused on making code more readable.
	Readability is the most important factor for software maintenance,
	and it also helps new developers who are unfamiliar with the codebase.
</p>
<p>
	First and foremost, it is recommended that each method fit in one page
	of text (30 lines by 80 columns).
	Whenever possible, longer methods should be decomposed to abide by this
	recommendation.
	This allows a developer to quickly read and understand the method's
	logic.
	It is much easier to spot and correct bugs in shorter methods.
	There should be no blank lines within a method.
</p>
<p>
	With methods longer than one page, it can be beneficial to have a
	single exit point (return).
	But for shorter methods (always the goal), this is not so important,
	and can reduce readability.
	It doesn't make sense to add a local "ret" variable with a single
	return statement at the end when the whole method can be read at a
	glance.
</p>
<p>
	Each block indent should be 8 columns (using tabs instead of spaces).
	This makes the blocks more obvious, and is easier to read than the 4
	spaces commonly used in other Java projects.
	Always use an indented block with if, for, while, etc. statements.
	This makes it much easier to follow the control flow than when it is
	combined onto the same line as the statement.
	Don't put an opening curly brace on a line by itself unless the method
	declaration or loop statement spans multiple lines.
	For single line blocks (if, for, while), do not use curly braces.
</p>
<p>
	Each method should have a javadoc comment describing its purpose.
	All parameters and return values should be documented as well.
	Comments within a method should be used sparingly &mdash; never
	describe what the code is doing, but instead <b>why</b> it was written
	in a certain way.
	Code which is "commented out" should <b>never</b> be committed to a
	repository.
</p>
<p>
	Unary operators, such as ++ -- ! ~ should be adjacent to their operand
	with no space.
	Binary operators, such as + - / * % &amp; | &amp;&amp; || &gt; = &lt;
	&gt;&gt; == != &lt;&lt; &gt;&gt;&gt; &gt;= &lt;= ^ should be separated
	from their operands by a space.
</p>

</div>

</body>
</html>
