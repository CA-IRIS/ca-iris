<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<!DOCTYPE svg PUBLIC '-//W3C//DTD SVG 1.1//EN'
	  'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'>
<svg id='meter_storage'
     width='560' height='480' version='1.1'
     xmlns='http://www.w3.org/2000/svg'
     xmlns:svg='http://www.w3.org/2000/svg'
     xmlns:xlink='http://www.w3.org/1999/xlink'>
<rect style='fill:#f1fff6;stroke:black;stroke-width:2'
      x='60' y='60' width='480' height='360'/>
<path style='fill:none;stroke:gray;stroke-width:0.25'
      d='M500 420L500 60M460 420L460 60M420 420L420 60M380 420L380 60M340 420
	 L340 60M300 420L300 60M260 420L260 60M220 420L220 60M180 420L180 60
	 M140 420L140 60M100 420L100 60'/>
<path style='fill:#ceffcf'
      d='M200 390L220 350 240 320 260 300 280 290 320 250 340 240 360 217
	 280 220 200 310Z'/>
<path style='fill:#fbffc2'
      d='M340 230L360 217 480 80 340 80'/>
<path style='fill:#def;stroke:#003373'
      d='M340 80L320 90 300 110 280 130 260 140 240 160 220 190 200 230
	 180 270 160 300 140 310 120 350 100 380 60 420 100 380 120 370
	 140 360 160 350 180 330 200 320 220 310 240 290 260 280 280 260
	 300 250 320 240 340 230'/>
<text style='font-size:24px' x='120' y='40'>Queue Storage Rate Limit</text>
<path id='volume_text' d='M40 320L40 60'/>
<text style='font-size:16px'>
  <textPath xlink:href='#volume_text'>Volume (Vehicles)</textPath>
</text>
<text style='font-size:16px' x='260' y='470'>Time (Steps)</text>
<text style='font-size:12px'>
  <tspan x='100' y='440'>t-12</tspan>
  <tspan x='140' y='440'>t-10</tspan>
  <tspan x='180' y='440'>t-8</tspan>
  <tspan x='220' y='440'>t-6</tspan>
  <tspan x='260' y='440'>t-4</tspan>
  <tspan x='300' y='440'>t-2</tspan>
  <tspan x='340' y='440'>t</tspan>
  <tspan x='380' y='440'>t+2</tspan>
  <tspan x='420' y='440'>t+4</tspan>
  <tspan x='460' y='440'>t+6</tspan>
  <tspan x='500' y='440'>t+8</tspan>
</text>
<text style='font-size:8px' x='100' y='390'>start metering</text>
<path id='queue_length'
      style='fill:none;stroke:black;stroke-dasharray:1,3'
      d='M340 230L340 80'/>
<text style='font-size:8px' transform='translate(-2,-40)'>
  <textPath xlink:href='#queue_length'>queue length</textPath>
</text>
<path id='target_rate'
      style='fill:none;stroke:purple;stroke-width:0.5'
      d='M140 310L340 80'/>
<text style='font-size:8px' transform='translate(84,-100)'>
  <textPath xlink:href='#target_rate'>target rate (5-minute)</textPath>
</text>
<path id='storage_limit'
      style='fill:none;stroke:#8d6666;stroke-dasharray:1,2'
      d='M340 240L480 80'/>
<text style='font-size:8px' transform='translate(28,-20)'>
  <textPath xlink:href='#storage_limit'>storage rate limit (parallel to target)</textPath>
</text>
<path id='queue_demand'
      style='fill:none'
      d='M140 260L260 120'/>
<text style='font-size:12px'>
  <textPath xlink:href='#queue_demand'>queue demand (input)</textPath>
</text>
<path id='metering_rate'
      style='fill:none'
      d='M160 340L340 210'/>
<text style='font-size:12px'>
  <textPath xlink:href='#metering_rate'>metering rate (output)</textPath>
</text>
<path style='fill:none;stroke:black;stroke-dasharray:1,2'
      d='M340 240L320 250 300 270 280 290 260 300 240 320 220 350 200 390'/>
<path id='max_storage'
      style='fill:none'
      d='M240 340L320 270'/>
<text style='font-size:8px'>
  <textPath xlink:href='#max_storage'>max storage</textPath>
</text>
<path id='v_text'
      style='fill:none;stroke:black;stroke-dasharray:1,2'
      d='M340 240L340 230'/>
<text style='font-size:8px' transform='translate(-2,0)'>
  <textPath xlink:href='#v_text'>v</textPath>
</text>
<path style='fill:none;stroke:black;stroke-dasharray:1,2'
      d='M340 230L360 217'/>
<path style='fill:none;stroke:gray;stroke-width:0.25'
      d='M200 230L200 390M220 190L220 350M240 160L240 320 240 320 240 320
	 M260 140L260 300M280 130C280 130 280 290 280 290M320 90L320 250'/>
<rect style='fill:white;stroke:black'
      x='320' y='280' width='200' height='120' ry='10'/>
<text style='font-size:12px' x='340' y='300'>
  <tspan x='340' y='300'>When queue occupancy is</tspan>
  <tspan x='340' y='312'>above a threshold, assume</tspan>
  <tspan x='340' y='324'>detector is undercounting â€”</tspan>
  <tspan x='340' y='336'>increase queue demand.</tspan>
  <tspan x='340' y='348'/>
  <tspan x='340' y='360'>r = 2 * period / max wait</tspan>
  <tspan x='340' y='372'>v = max storage - queue len</tspan>
  <tspan x='340' y='384'>demand += r * min(v, 1)
  </tspan>
</text>
</svg>
