<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8" name="Author" content="Douglas Lau"/>
	<link href="iris_doc.css" rel="stylesheet" type="text/css"/>
	<title>Density Adaptive Metering</title>
</head>

<body>
<h2>Objectives</h2>
<p>
	The density adaptive ramp metering algorithm has two main objectives:
</p>
<ol>
<li>Delay the onset of mainline congestion for as long as possible.
    This is achieved by restricting metering rates when
    <a href='#density'>density</a> on the mainline approaches a critical level.
</li>
<li>Effectively manage the queue at ramp meters.
    Wait times should rarely be longer than a configurable time.
    Release rates should be adjusted gradually.
    Also, the queue should not back up onto cross streets.
</li>
</ol>
<h2>Bottleneck Identification</h2>
<p>
	At each time interval, all mainline stations on a freeway corridor are
	checked for bottlenecks.
	First, candidates are selected based on
	<a href='#station_density'>station density</a>.
	Then, bottlenecks are merged with other nearby bottlenecks.
</p>
<h3>Candidate Bottlenecks</h3>
<svg class="right" xmlns="http://www.w3.org/2000/svg" version="1.1"
     width='560' height='200' viewBox='0,0,560,200'>
<title>Bottleneck Identification</title>
<defs>
  <marker id='DotM' style='overflow:visible' orient='auto'>
    <path style='stroke:black'
	  d='M1.96 0C1.96 1.104 1.064 2-0.04 2C-1.144 2-2.04 1.104-2.04 0
	     C-2.04-1.104-1.144-2-0.04-2C1.064-2 1.96-1.104 1.96 0Z'/>
  </marker>
  <marker id='Arrow1Mend' style='overflow:visible' orient='auto'>
    <path style='stroke:black'
	  d='M-4 0L-6 2L1 0L-6-2L-4 0Z'/>
  </marker>
</defs>
<g style='fill:none;stroke:black'>
  <path d='M10 10 L550 10 M10 50 L550 50'/>
</g>
<g style='fill:#0a0;opacity:0.25'>
  <rect x='30' y='20' width='10' height='20'/>
  <rect x='130' y='20' width='10' height='20'/>
  <rect x='230' y='20' width='10' height='20'/>
  <rect x='320' y='20' width='10' height='20'/>
  <rect x='420' y='20' width='10' height='20'/>
  <rect x='520' y='20' width='10' height='20'/>
</g>
<g style='fill:#faa'>
  <rect x='126' y='55' width='26' height='132' rx='13' ry='8'/>
  <rect x='516' y='55' width='26' height='132' rx='13' ry='8'/>
  <rect x='200' y='166' width='170' height='18' rx='6' ry='9'/>
</g>
<g style='fill:#fda'>
  <rect x='126' y='55' width='26' height='112' rx='13' ry='8'/>
  <rect x='416' y='55' width='26' height='112' rx='13' ry='8'/>
  <rect x='516' y='55' width='26' height='112' rx='13' ry='8'/>
  <rect x='200' y='146' width='170' height='18' rx='6' ry='9'/>
</g>
<g style='fill:none;stroke:black;opacity:0.5;marker-end:url(#Arrow1Mend)'>
  <path d='M60 30 L110 30'/>
  <path d='M160 30 L210 30'/>
  <path d='M260 30 L300 30'/>
  <path d='M350 30 L400 30'/>
  <path d='M450 30 L500 30'/>
</g>
<rect style='fill:white;stroke:black;opacity:0.5'
      x='20' y='80' width='520' height='60'/>
<path style='fill:none;stroke:black;marker-start:url(#DotM);
             marker-mid:url(#DotM);marker-end:url(#DotM)'
      d='M40 130L140 100L240 120L330 130L430 100L530 80'/>
<text style='font-size:14px;font-style:normal'>
  <tspan x='30' y='70'>S1</tspan>
  <tspan x='130' y='70'>S2</tspan>
  <tspan x='230' y='70'>S3</tspan>
  <tspan x='320' y='70'>S4</tspan>
  <tspan x='420' y='70'>S5</tspan>
  <tspan x='520' y='70'>S6</tspan>
  <tspan x='30' y='100'>Density</tspan>
  <tspan x='130' y='160'>S2</tspan>
  <tspan x='420' y='160'>S5</tspan>
  <tspan x='520' y='160'>S6</tspan>
  <tspan x='214' y='160'>candidate bottlenecks</tspan>
  <tspan x='130' y='180'>S2</tspan>
  <tspan x='520' y='180'>S6</tspan>
  <tspan x='220' y='180'>merged bottlenecks</tspan>
</text>
</svg>
<p>
	A mainline station is a candidate bottleneck if one of the following
	conditions are met:
</p>
<ul>
<li><a href='#station_density'>Station density</a> is above bottleneck density
    for each interval in 90 seconds.</li>
<li><a href='#station_density'>Station density</a> is above bottleneck density,
    AND
</li>
    <ul>
    <li>Station was a bottleneck in previous interval, OR</li>
    <li><a href='#station_density'>Station density</a> is trending higher for
        each interval in 90 seconds.</li>
    </ul>
</ul>
<h3>Bottleneck Merging</h3>
<p>
	Starting from downstream, each candidate bottleneck is checked.
	An upstream candidate will be merged into the bottleneck if the
	following conditions are met:
</p>
<ul>
<li>The candidates are within 1.5 miles, AND</li>
    <ul>
    <li>The upstream density is lower, OR</li>
    <li>Upstream acceleration is less than 1000 miles / hr²</li>
    </ul>
<li>Upstream acceleration is less than 1000 miles / hr²</li>
</ul>
<h2 class='clear'>Metering Rates</h2>
<p>
	To calculate metering rates, the mainline segment density is used,
	in addition to the ramp demand and queue condition.
	For each interval, a ramp meter has a minimum and maximum metering rate.
</p>

<svg class='right' version="1.1" xmlns="http://www.w3.org/2000/svg"
     xmlns:xlink='http://www.w3.org/1999/xlink'
     width='400' height='410' viewBox='0,0,400,410'>
<title>Ramp Meter Queueing</title>
<text style='font-size:20pt' x='140' y='20'>Queueing</text>
<path id='count_text_0' d='M40 250 V60'/>
<text style='font-size:14pt'>
  <textPath xlink:href='#count_text_0'>Vehicle Count</textPath>
</text>
<text style='font-size:14pt' x='180' y='404'>Time (Steps)</text>
<text style='font-size:9pt'>
  <tspan x='100' y='380'>t-12</tspan>
  <tspan x='140' y='380'>t-10</tspan>
  <tspan x='180' y='380'>t-8</tspan>
  <tspan x='220' y='380'>t-6</tspan>
  <tspan x='260' y='380'>t-4</tspan>
  <tspan x='300' y='380'>t-2</tspan>
  <tspan x='340' y='380'>t</tspan>
</text>
<rect style='fill:#f6f6ff;stroke:black;stroke-width:2'
      x='60' y='40' width='320' height='320'/>
<path style='fill:none;stroke:gray;stroke-width:0.25'
      d='M100 40V360 M140 40V360 M180 40V360 M220 40V360 M260 40V360 M300 40V360
         M340 40V360'/>
<path style='fill:#def;stroke:#003373'
      d='M340 60 L320 70 300 90 280 100 260 110 240 130 220 160 200 180
	 180 210 160 240 140 260 120 280 100 320 60 360 100 320 120 310
	 140 290 180 260 220 230 260 210 300 180 340 160'/>
<text style='font-size:8pt' x='100' y='330'>metering begins</text>
<path id='queue_demand_0' d='M160 230 260 80'/>
<text style='font-size:9pt'>
  <textPath xlink:href='#queue_demand_0'>demand (input)</textPath>
</text>
<path id='passage_rate_0' d='M180 250 340 150'/>
<text style='font-size:9pt'>
  <textPath xlink:href='#passage_rate_0'>passage (output)</textPath>
</text>
<path id='queue_length_0' style='stroke:black;stroke-dasharray:1,3'
      d='M340 160L340 60'/>
<text style='font-size:8pt' transform='translate(-4,-14)'>
  <textPath xlink:href='#queue_length_0'>queue length</textPath>
</text>
<path id='wait_time_0' style='stroke:black;stroke-dasharray:1,2'
      d='M220 160H340'/>
<text style='font-size:8pt' transform='translate(40,-2)'>
  <textPath xlink:href='#wait_time_0'>wait time</textPath>
</text>
</svg>

<h3>Queueing</h3>
<p>
	A queue is formed at a ramp meter when the input (demand) is greater
	than the output (passage).
	These values are used to estimate the length of a queue, by comparing
	the accumulated demand and passage.
</p>
<p>
	Unfortunately, vehicle detection systems are not 100% accurate.
	For improved accuracy, the accumulated demand and passage values are
	reset to zero when there is no queue.
	Also, when the queue is full the accumulated demand is adjusted so that
	the queue length matches a maximum storage length for that ramp.
</p>

<br class='clear'/>

<svg class='right' version="1.1" xmlns="http://www.w3.org/2000/svg"
     xmlns:xlink='http://www.w3.org/1999/xlink'
     width='400' height='450' viewBox='0,20,400,450'>
<title>Demand Undercount Correction</title>
<text style='font-size:20pt' x='100' y='40'>Demand Correction</text>
<path id='count_text_1' d='M40 300 V60'/>
<text style='font-size:14pt'>
  <textPath xlink:href='#count_text_1'>Vehicle Count</textPath>
</text>
<text style='font-size:14pt' x='180' y='464'>Time (Steps)</text>
<text style='font-size:9pt'>
  <tspan x='100' y='440'>t-12</tspan>
  <tspan x='140' y='440'>t-10</tspan>
  <tspan x='180' y='440'>t-8</tspan>
  <tspan x='220' y='440'>t-6</tspan>
  <tspan x='260' y='440'>t-4</tspan>
  <tspan x='300' y='440'>t-2</tspan>
  <tspan x='340' y='440'>t</tspan>
</text>
<rect style='fill:#f6f6ff;stroke:black;stroke-width:2'
      x='60' y='60' width='320' height='360'/>
<path style='fill:none;stroke:gray;stroke-width:0.25'
      d='M100 60V420 M140 60V420 M180 60V420 M220 60V420 M260 60V420 M300 60V420
         M340 60V420'/>
<path style='fill:#ffd2d2;stroke:#003373;stroke-dasharray:1,2'
      d='M340 90L320 110 300 140 280 160 300 150 320 130 340 120'/>
<path style='fill:#def;stroke:#003373'
      d='M340 120L320 130 300 150 280 160 260 170 240 180 220 200 200 240
	 180 270 160 300 140 310 120 350 100 380 60 420 100 380 120 370
	 140 350 180 320 220 290 260 270 300 260 340 240'/>
<path id='occ_spike_1' d='M280 160 340 90'/>
<text style='font-size:9pt' transform='translate(6,-14)'>
  <textPath xlink:href='#occ_spike_1'>occ. &gt; 25%</textPath>
</text>
<text style='font-size:9pt' x='100' y='390'>metering begins</text>
<path id='queue_length_1' style='stroke:black;stroke-dasharray:1,3'
      d='M340 240L340 120'/>
<text style='font-size:9pt' transform='translate(-2,-32)'>
  <textPath xlink:href='#queue_length_1'>queue length</textPath>
</text>
<path id='queue_demand_1' d='M160 270 260 120'/>
<text style='font-size:9pt'>
  <textPath xlink:href='#queue_demand_1'>demand (input)</textPath>
</text>
<path id='passage_rate_1' d='M180 310 340 210'/>
<text style='font-size:9pt'>
  <textPath xlink:href='#passage_rate_1'>passage (output)</textPath>
</text>
<path id='max_storage_1' d='M350 180 350 90'/>
<text style='font-size:9pt'>
  <textPath xlink:href='#max_storage_1'>max storage</textPath>
</text>
<path style='stroke:#b10000;stroke-dasharray:1,3' d='M280 90L340 90'/>
<text style='font-size:9pt' x='292' y='88'>duration</text>
</svg>

<h4>Demand (Input)</h4>
<p>
	The demand at a ramp meter is estimated using ramp queue detection.
	A cumulative demand value is taken from the time when metering begins.
	This demand is treated as the queue input.
	The cumulative metering rate is used for the queue output.
	Assuming these values are correct, the difference between them at any
	point in time represents the queue length (in vehicles).
</p>
<p>
	Of course, sometimes data collection errors need to be corrected.
	One of the most common errors in undercounting at the queue detector.
	This can happen when the queue backs up over a queue detector.
	When this happens, the queue detector occupancy will jump to greater
	than 25%.
	In this case, the detector is assumed to be undercounting.
	The estimated queue demand is increased gradually until the queue
	length is equal to the maximum storage.
</p>
<pre>
	duration (of occupancy spike)

	r = 2 * duration / max_wait
	v = max storage - queue len
	demand += max(r * v, 1)
</pre>
<p>
	If the queue detector is malfunctioning, the demand is set to a fixed
	target value.
	This target value is specific to one ramp meter and metering period
	(AM or PM).
	It should be set based on historical demand at the ramp.
</p>

<h4>Passage (Output)</h4>
<p>
	The passage detector is used to estimate the output of the queue.
	In general, this detector is less succeptible to problems than the
	queue detector.
</p>

<h3>Minimum Rate</h3>
<p>
	The minimum rate is determined by the state of the ramp queue.
	When the passage detector malfunctions, it is equal to the average
	demand rate for the previous 5 minutes.
	Otherwise, it is the highest of the following 3 limits:
</p>
<ul>
	<li>Queue storage limit</li>
	<li>Queue wait limit</li>
	<li>Target minimum rate limit</li>
</ul>

<svg class="right" version="1.1" xmlns="http://www.w3.org/2000/svg"
     xmlns:xlink='http://www.w3.org/1999/xlink'
     width='560' height='450' viewBox='0,20,560,450'>
<title>Queue Storage Limit</title>
<text style='font-size:20pt' x='166' y='40'>Queue Storage Limit</text>
<path id='count_text_2' d='M40 300 V60'/>
<text style='font-size:14pt'>
  <textPath xlink:href='#count_text_2'>Vehicle Count</textPath>
</text>
<text style='font-size:14pt' x='260' y='464'>Time (Steps)</text>
<text style='font-size:9pt'>
  <tspan x='100' y='440'>t-12</tspan>
  <tspan x='140' y='440'>t-10</tspan>
  <tspan x='180' y='440'>t-8</tspan>
  <tspan x='220' y='440'>t-6</tspan>
  <tspan x='260' y='440'>t-4</tspan>
  <tspan x='300' y='440'>t-2</tspan>
  <tspan x='340' y='440'>t</tspan>
  <tspan x='380' y='440'>t+2</tspan>
  <tspan x='420' y='440'>t+4</tspan>
  <tspan x='460' y='440'>t+6</tspan>
  <tspan x='500' y='440'>t+8</tspan>
</text>
<rect style='fill:#f6f6ff;stroke:black;stroke-width:2'
      x='60' y='60' width='480' height='360'/>
<path style='fill:none;stroke:gray;stroke-width:0.25'
      d='M100 60V420 M140 60V420 M180 60V420 M220 60V420 M260 60V420 M300 60V420
         M340 60V420 M380 60V420 M420 60V420 M460 60V420 M500 60V420'/>
<path style='fill:#fffcbb'
      d='M200 370L240 320 280 290 320 250 340 240 500 80 460 80 200 270Z'/>
<path style='fill:#ceffcf'
      d='M200 330L240 280 280 250 320 210 340 200 460 80 340 80 340 140
	 200 270Z'/>
<path style='fill:#def;stroke:#003373'
      d='M340 80L320 90 300 110 280 130 240 160 200 210 180 250 160 270
	 140 280 120 320 100 380 60 420 100 380 120 360 140 350 160 330
	 180 300 220 270 240 260 260 240 280 230 300 210 320 200 340 180'/>
<path style='fill:none;stroke:#509200;stroke-dasharray:1,2'
      d='M200 330L240 280 280 250 320 210 340 200'/>
<path style='fill:none;stroke:black;stroke-dasharray:1,2'
      d='M200 370L240 320 280 290 320 250 340 240 500 80'/>
<text style='font-size:8pt' x='100' y='390'>metering begins</text>
<path id='queue_length_2' style='stroke:black;stroke-dasharray:1,3'
      d='M340 180L340 80'/>
<text style='font-size:8pt' transform='translate(-2,-22)'>
  <textPath xlink:href='#queue_length_2'>queue length</textPath>
</text>
<path id='target_rate_2' style='stroke:purple;stroke-width:0.5'
      d='M140 280L340 80'/>
<text style='font-size:8pt' transform='translate(100,-86)'>
  <textPath xlink:href='#target_rate_2'>target rate (5-minute)</textPath>
</text>
<path id='storage_limit_2' style='stroke:#003373;stroke-dasharray:1,2'
      d='M340 180L460 80'/>
<text style='font-size:11pt' transform='translate(28,-28)'>
  <textPath xlink:href='#storage_limit_2'>storage limit</textPath>
</text>
<path id='target_storage_2' d='M280 264 340 210'/>
<text style='font-size:8pt'>
  <textPath xlink:href='#target_storage_2'>target storage</textPath>
</text>
<path id='projected_storage_2' style='stroke:#509200;stroke-dasharray:1,2'
      d='M340 200L460 80'/>
<text style='font-size:7pt' transform='translate(6,6)'>
  <textPath xlink:href='#projected_storage_2'>
  projected storage (parallel to target)
  </textPath>
</text>
<path id='queue_demand_2' d='M140 270 260 130'/>
<text style='font-size:9pt'>
  <textPath xlink:href='#queue_demand_2'>demand (input)</textPath>
</text>
<path id='passage_rate_2' d='M200 280 340 170'/>
<text style='font-size:9pt'>
  <textPath xlink:href='#passage_rate_2'>passage (output)</textPath>
</text>
<path id='max_storage_2' d='M280 304 340 250'/>
<text style='font-size:8pt'>
  <textPath xlink:href='#max_storage_2'>max storage</textPath>
</text>
<path style='fill:none;stroke:gray;stroke-width:0.25'
      d='M200 210L200 370M240 160L240 320 240 320 240 320M280 130L280 290
	 M320 90L320 250M340 240L340 80'/>
</svg>

<h4>Queue Storage Limit</h4>
<p>
	The purpose of the queue storage limit is to prevent the queue from
	becoming more than 75% full.
	First, the target storage (75% of maximum storage) is subtracted from
	the accumulated demand.
	Then, this value is projected into the future to the target wait time
	(75% of maximum wait time), using the demand rate from the previous
	5 minutes.
	The queue storage limit is the rate from the current accumulated
	passage to that projected target storage (in the target wait time).
</p>

<svg class="left" version="1.1" xmlns="http://www.w3.org/2000/svg"
     xmlns:xlink='http://www.w3.org/1999/xlink'
     width='560' height='450' viewBox='0,20,560,450'>
<title>Queue Storage Limit (Fixed)</title>
<text style='font-size:20pt' x='140' y='40'>Queue Storage Limit (Fixed)</text>
<path id='count_text_3' d='M40 300 V60'/>
<text style='font-size:14pt'>
  <textPath xlink:href='#count_text_3'>Vehicle Count</textPath>
</text>
<text style='font-size:14pt' x='260' y='464'>Time (Steps)</text>
<text style='font-size:9pt'>
  <tspan x='100' y='440'>t-12</tspan>
  <tspan x='140' y='440'>t-10</tspan>
  <tspan x='180' y='440'>t-8</tspan>
  <tspan x='220' y='440'>t-6</tspan>
  <tspan x='260' y='440'>t-4</tspan>
  <tspan x='300' y='440'>t-2</tspan>
  <tspan x='340' y='440'>t</tspan>
  <tspan x='380' y='440'>t+2</tspan>
  <tspan x='420' y='440'>t+4</tspan>
  <tspan x='460' y='440'>t+6</tspan>
  <tspan x='500' y='440'>t+8</tspan>
</text>
<rect style='fill:#f6f6ff;stroke:black;stroke-width:2'
      x='60' y='60' width='480' height='360'/>
<path style='fill:none;stroke:gray;stroke-width:0.25'
      d='M100 60V420 M140 60V420 M180 60V420 M220 60V420 M260 60V420 M300 60V420
         M340 60V420 M380 60V420 M420 60V420 M460 60V420 M500 60V420'/>
<path style='fill:#fffcbb'
      d='M220 350 L220 400 500 80 460 80'/>
<path style='fill:#ceffcf'
      d='M220 270L220 350 460 80 340 80'/>
<path style='fill:#def;stroke:#003373'
      d='M340 80L100 340 L60 380 100 340 120 335 140 330 160 320 180 310 200 300
         220 280 240 270 260 250 280 230 300 220 320 200 340 180'/>
<path style='stroke:#509200;stroke-dasharray:1,2'
      d='M220 350L460 80'/>
<path style='stroke:black;stroke-dasharray:1,2'
      d='M220 400L500 80'/>
<text style='font-size:8pt' x='100' y='350'>metering begins</text>
<path id='queue_length_3' style='stroke:black;stroke-dasharray:1,3'
      d='M340 180 340 80'/>
<text style='font-size:8pt' transform='translate(-2,-16)'>
  <textPath xlink:href='#queue_length_3'>queue length</textPath>
</text>
<path id='queue_demand_3' d='M180 246 300 116'/>
<text style='font-size:9pt'>
  <textPath xlink:href='#queue_demand_3'>demand (input) — fixed target
  </textPath>
</text>
<path id='passage_rate_3' d='M200 290 320 190'/>
<text style='font-size:9pt'>
  <textPath xlink:href='#passage_rate_3'>passage (output)</textPath>
</text>
<path id='storage_limit_3'
      style='stroke:#003373;stroke-dasharray:1,2'
      d='M340 180L460 80'/>
<text style='font-size:11pt' transform='translate(20,-22)'>
  <textPath xlink:href='#storage_limit_3'>storage limit</textPath>
</text>
<path id='target_storage_3' d='M290 290 350 220'/>
<text style='font-size:8pt'>
  <textPath xlink:href='#target_storage_3'>target storage</textPath>
</text>
<path id='max_storage_3' d='M300 328 360 258'/>
<text style='font-size:8pt'>
  <textPath xlink:href='#max_storage_3'>max storage</textPath>
</text>
</svg>

<p>
	When the queue detector is malfunctioning, the target value for the
	current metering period (AM or PM) is used for demand.
	This makes the queue storage limit behave as if the demand is high at
	all times.
	While not optimal, it allows short queues to be held to break up
	platoons of vehicles.
</p>

<br class='clear'/>

<svg class='right' version="1.1" xmlns="http://www.w3.org/2000/svg"
     xmlns:xlink='http://www.w3.org/1999/xlink'
     width='560' height='450' viewBox='0,20,560,450'>
<title>Queue Wait Limit</title>
<text style='font-size:20pt' x='190' y='40'>Queue Wait Limit</text>
<path id='count_text_4' d='M40 300 V60'/>
<text style='font-size:14pt'>
  <textPath xlink:href='#count_text_4'>Vehicle Count</textPath>
</text>
<text style='font-size:14pt' x='260' y='464'>Time (Steps)</text>
<text style='font-size:9pt'>
  <tspan x='100' y='440'>t-12</tspan>
  <tspan x='140' y='440'>t-10</tspan>
  <tspan x='180' y='440'>t-8</tspan>
  <tspan x='220' y='440'>t-6</tspan>
  <tspan x='260' y='440'>t-4</tspan>
  <tspan x='300' y='440'>t-2</tspan>
  <tspan x='340' y='440'>t</tspan>
  <tspan x='380' y='440'>t+2</tspan>
  <tspan x='420' y='440'>t+4</tspan>
  <tspan x='460' y='440'>t+6</tspan>
  <tspan x='500' y='440'>t+8</tspan>
</text>
<rect style='fill:#f6f6ff;stroke:black;stroke-width:2'
      x='60' y='60' width='480' height='360'/>
<path style='fill:none;stroke:gray;stroke-width:0.25'
      d='M100 60V420 M140 60V420 M180 60V420 M220 60V420 M260 60V420 M300 60V420
         M340 60V420 M380 60V420 M420 60V420 M460 60V420 M500 60V420'/>
<path style='fill:#fffcbb'
      d='M500 100L420 100 260 240 220 380 260 380 280 340 300 310 320 290
	 340 270 380 240 420 200 440 160 460 130 480 110'/>
<path style='fill:#ceffcf'
      d='M260 240L340 100 460 100 440 110 420 130 400 160 380 200 340 240
	 300 270 260 310 240 340 220 380 100 380'/>
<path style='fill:#def;stroke:#003373'
      d='M340 100L320 110 300 130 280 160 260 200 220 240 180 270 140 310
	 120 340 100 380 60 420 100 380 120 370 140 350 160 340 200 310
	 220 300 260 290 300 260 340 220'/>
<path style='fill:none;stroke:gray;stroke-width:0.25'
      d='M120 340H280 M140 310H300 M180 270H340 M220 240H380 M260 200H420
         M280 160H440 M300 130H460 M320 110H480'/>
<path style='fill:none;stroke:#509200;stroke-dasharray:1,2'
      d='M220 380L240 340 260 310 280 290 300 270 340 240 380 200 400 160
	 420 130 440 110 460 100'/>
<path style='fill:none;stroke:black;stroke-dasharray:1,2'
      d='M500 100L480 110 460 130 440 160 420 200 380 240 340 270 300 310
	 280 340 260 380'/>
<text style='font-size:8pt' x='100' y='390'>metering begins</text>
<path id='wait_time_4' style='stroke:black;stroke-dasharray:1,2'
      d='M240 220H340'/>
<text style='font-size:8pt' transform='translate(32,-2)'>
  <textPath xlink:href='#wait_time_4'>wait time</textPath>
</text>
<path id='max_wait_4' d='M360 270 420 220'/>
<text style='font-size:8pt'>
  <textPath xlink:href='#max_wait_4'>max wait</textPath>
</text>
<path id='target_wait_4' d='M320 270 380 220'/>
<text style='font-size:8pt'>
  <textPath xlink:href='#target_wait_4'>target wait</textPath>
</text>
<path style='fill:none;stroke:#003373;stroke-dasharray:1,2;opacity:0.25'
      d='M340 220L460 100 M340 220L380 200 M340 220L360 220'/>
<path id='queue_wait_4' style='stroke:#003373;stroke-dasharray:1,2'
      d='M340 220L420 130'/>
<text style='font-size:10pt' transform='translate(10,-18)'>
  <textPath xlink:href='#queue_wait_4'>queue wait limit</textPath>
</text>
<path id='queue_demand_4' d='M140 300 260 180'/>
<text style='font-size:9pt'>
  <textPath xlink:href='#queue_demand_4'>demand (input)</textPath>
</text>
<path id='passage_rate_4' d='M160 320 320 250'/>
<text style='font-size:9pt'>
  <textPath xlink:href='#passage_rate_4'>passage (output)</textPath>
</text>
</svg>

<h4>Queue Wait Limit</h4>
<p>
	The purpose of the queue wait limit is to prevent vehicles from waiting
	in the queue for longer than the maximum wait time.
	For each interval until the target wait time (75% of maximum wait time),
	a wait limit is calculated.
	This is done by taking the accumulated demand at the target wait time
	before each of those intervals.
	That demand is used to calculate a rate limit from the current
	accumulated passage.
	The queue wait limit is the highest of the limits for these intervals.
</p>

<br class='clear'/>

<svg class='left' version="1.1" xmlns="http://www.w3.org/2000/svg"
     xmlns:xlink='http://www.w3.org/1999/xlink'
     width='560' height='450' viewBox='0,20,560,450'>
<title>Queue Wait Limit (Fixed)</title>
<text style='font-size:20pt' x='160' y='40'>Queue Wait Limit (Fixed)</text>
<path id='count_text_5' d='M40 300 V60'/>
<text style='font-size:14pt'>
  <textPath xlink:href='#count_text_5'>Vehicle Count</textPath>
</text>
<text style='font-size:14pt' x='260' y='464'>Time (Steps)</text>
<text style='font-size:9pt'>
  <tspan x='100' y='440'>t-12</tspan>
  <tspan x='140' y='440'>t-10</tspan>
  <tspan x='180' y='440'>t-8</tspan>
  <tspan x='220' y='440'>t-6</tspan>
  <tspan x='260' y='440'>t-4</tspan>
  <tspan x='300' y='440'>t-2</tspan>
  <tspan x='340' y='440'>t</tspan>
  <tspan x='380' y='440'>t+2</tspan>
  <tspan x='420' y='440'>t+4</tspan>
  <tspan x='460' y='440'>t+6</tspan>
  <tspan x='500' y='440'>t+8</tspan>
</text>
<rect style='fill:#f6f6ff;stroke:black;stroke-width:2'
      x='60' y='60' width='480' height='360'/>
<path style='fill:none;stroke:gray;stroke-width:0.25'
      d='M100 60V420 M140 60V420 M180 60V420 M220 60V420 M260 60V420 M300 60V420
         M340 60V420 M380 60V420 M420 60V420 M460 60V420 M500 60V420'/>
<path style='fill:#fffcbb'
      d='M500 100L420 100 260 240 220 380 260 380'/>
<path style='fill:#ceffcf'
      d='M260 240L340 100 460 100 220 380 100 380'/>
<path style='fill:#def;stroke:#003373'
      d='M340 100L100 380 60 420 100 380 120 370 140 360 160 340 220 300
	 240 290 280 270 320 240 340 220'/>
<path style='stroke:#509200;stroke-dasharray:1,2'
      d='M220 380L460 100'/>
<path style='stroke:black;stroke-dasharray:1,2'
      d='M500 100L260 380'/>
<text style='font-size:8pt' x='100' y='390'>start metering</text>
<path id='wait_time_5' style='stroke:black;stroke-dasharray:1,2'
      d='M238 220L340 220'/>
<text style='font-size:8pt' transform='translate(32,-2)'>
  <textPath xlink:href='#wait_time_5'>wait time</textPath>
</text>
<path id='max_wait_5' d='M360 280 420 210'/>
<text style='font-size:8pt'>
  <textPath xlink:href='#max_wait_5'>max wait</textPath>
</text>
<path id='target_wait_5' d='M320 280 380 210'/>
<text style='font-size:8pt'>
  <textPath xlink:href='#target_wait_5'>target wait</textPath>
</text>
<path id='queue_wait_5' style='stroke:#003373;stroke-dasharray:1,2'
      d='M340 220L460 100'/>
<text style='font-size:10pt' transform='translate(24,-32)'>
  <textPath xlink:href='#queue_wait_5'>queue wait limit</textPath>
</text>
<path id='queue_demand_5' d='M180 280 300 140'/>
<text style='font-size:9pt'>
  <textPath xlink:href='#queue_demand_5'>demand (input) — fixed target
  </textPath>
</text>
<path id='passage_rate_5' d='M180 320 320 230'/>
<text style='font-size:9pt'>
  <textPath xlink:href='#passage_rate_5'>passage (output)</textPath>
</text>
</svg>

<p>
	When the queue detector is malfunctioning, the target value for the
	current metering period (AM or PM) is used for demand.
	This makes the queue wait limit behave as if the demand is high at all
	times.
	While not optimal, it allows short queues to be held to break up
	platoons of vehicles.
</p>

<h2 class='clear'>Metering Period</h2>
<svg class="right" xmlns="http://www.w3.org/2000/svg" version="1.1"
     width="240" height="480">
  <title>Metering Phases</title>
  <defs>
    <marker id='Arrow1Mend' style='overflow:visible' orient='auto'>
      <path style='stroke:black;stroke-width:1pt'
            d='m-4 0l-2 2l7-2l-7-2l2 2z'/>
    </marker>
  </defs>
  <g style='fill:none;stroke:black;stroke-width:2'>
    <rect fill='#fda' x='20' y='10' width='200' height='60' rx='8' ry='8'/>
    <rect fill='#afa' x='20' y='110' width='200' height='60' rx='8' ry='8'/>
    <rect fill='#7f7' x='20' y='210' width='140' height='60' rx='8' ry='8'/>
    <rect fill='#efa' x='20' y='310' width='140' height='60' rx='8' ry='8'/>
    <rect fill='#faa' x='20' y='410' width='140' height='60' rx='8' ry='8'/>
  </g>
  <text style='font-size:24px'>
    <tspan x='40' y='50'>Not started</tspan>
    <tspan x='40' y='150'>Early Metering</tspan>
    <tspan x='40' y='250'>Metering</tspan>
    <tspan x='40' y='350'>Flushing</tspan>
    <tspan x='40' y='450'>Stopped</tspan>
  </text>
  <g style='fill:none;stroke:black;stroke-width:2;marker-end:url(#Arrow1Mend)'>
    <path d='m90 70l0 40'/>
    <path d='m90 170l0 40'/>
    <path d='m90 270l0 40'/>
    <path d='m90 370l0 40'/>
    <path d='m160 440c60 0 60-40 60-100c0-60 0-100-60-100'/>
  </g>
</svg>
<p>
	A metering period begins and ends at specific times during the day.
	Within the metering period, a meter can be in one of 5 phases:
	<a href='#not_started'>not started</a>,
	<a href='#early_metering'>early metering</a>,
	<a href='#metering'>metering</a>,
	<a href='#flushing'>flushing</a> or <a href='#stopped'>stopped</a>.
	When transition conditions are met, the meter moves to the next phase.
	If all meters on a corridor are in the <a href='#stopped'>stopped</a>
	phase, the metering period ends.
</p>
<h3 id='not_started'>Not Started Phase</h3>
<p>
	Ramp meters begin each metering period in this phase.
	The meter will not cycle until the phase is changed.
	There are two conditions which can cause the meter to transition to the
	<a href='#early_metering'>early metering</a> phase:
</p>
<ul>
<li>Passage flow rate was greater than 80% of selected metering rate for each
    interval in 90 seconds.</li>
<li>Segment density was higher than bottleneck density for each interval in 90
    seconds.</li>
</ul>
<p>
	When there are 30 minutes left in the metering period, the meter will
	transition from <a href='#not_started'>not started</a> to
	<a href='#stopped'>stopped</a>.
</p>
<h3 id='early_metering'>Early Metering Phase</h3>
<p>
	In this phase, a ramp meter will cycle at the selected metering rate.
	There are three conditions which can cause the meter to transition to
	the <a href='#metering'>metering</a> phase:
</p>
<ul>
<li><a href='#segment_density'>Segment density</a> (15 minute average) was
    trending lower for each interval in 5 minutes.</li>
<li><a href='#segment_density'>Segment density</a> (1 minute average) was lower
    than 65% of critical density.</li>
<li>Only 30 minutes remain in the metering period.</li>
</ul>
<h3 id='metering'>Metering Phase</h3>
<p>
	In this phase, a ramp meter will cycle at the selected metering rate.
	The following conditions will cause the meter to transition to the
	<a href='#flushing'>flushing</a> phase:
</p>
<ul>
<li><a href='#segment_density'>Segment density</a> was below desired density
    (29.6) for every interval in 5 minutes, AND</li>
    <ul>
    <li>Passage rate (60 second smoothed) was lower than metering rate for
        all intervals in 5 minutes, OR</li>
    <li>The segment had no bottleneck for 5 minutes.</li>
    </ul>
<li>Only 2 minutes remain in the metering period.</li>
</ul>
<h3 id='flushing' class='pagebreak'>Flushing Phase</h3>
<p>
	In this phase, a ramp meter will cycle at the maximum metering rate.
	The following conditions will cause the meter to transition to the
	<a href='#stopped'>stopped</a> phase:
</p>
<ul>
<li>The queue is estimated to be empty for 1 minute.</li>
<li>The metering period ends.</li>
</ul>
<h3 id='stopped'>Stopped Phase</h3>
<p>
	In this phase, a ramp meter will not cycle.
	There are two conditions which can cause the meter to transition back
	to the <a href='#metering'>metering</a> phase:
</p>
<ul>
<li>Passage flow rate was greater than 80% of selected metering rate for each
    interval in 5 minutes.</li>
<li><a href='#segment_density'>Segment density</a> was higher than bottleneck
    density for each interval in 5 minutes.</li>
</ul>
<h2>Definitions</h2>
<dl>
	<dt id='density'>Density</dt>
	<dd>Vehicles per lane-mile</dd>
	<dt id='station_density'>Station Density</dt>
	<dd>Average of all valid lanes in a station for one sample period</dd>
	<dt>Interval Density</dt>
	<dd>Average of station samples during one 60 second interval</dd>
	<dt>Meter Segment</dt>
	<dd>A contiguous series of stations associated with a ramp meter.
	    It begins at the station just upstream of the meter.
	    The downstream end is the first bottleneck within 3 miles (or the
	    last station within 3 miles if no bottleneck exists).</dd>
	<dt id='segment_density'>Segment Density</dt>
	<dd>Each consecutive pair of stations is divided into 3 equal links.
	    The first and last links are assigned density from the station
	    adjacent to them.
	    The middle link is assigned a density which is an average of the
	    two stations.
	    The segment density is an average of all links in the segment,
	    weighted by length.</dd>
</dl>
</body>
</html>
